<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Together We Are One</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- PNG Export helper -->
  <script src="https://unpkg.com/leaflet-image@0.4.0/leaflet-image.js"></script>

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Together We Are One">
  <meta property="og:description" content="A quiet place. You set a light and see that many feel the same.">
  <meta property="og:image" content="https://togetherweareone.earth/TogetherWeAreOneEarth.jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">
  <meta property="og:url" content="https://togetherweareone.earth/">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://togetherweareone.earth/TogetherWeAreOneEarth.jpeg">

  <style>
:root{
  --bg0:#0b0d12;
  --bg1:#121526;
  --card: rgba(255,255,255,0.06);
  --card2: rgba(255,255,255,0.08);
  --stroke: rgba(255,255,255,0.10);
  --ghost: rgba(255,255,255,0.25);
  --text: rgba(255,255,255,0.92);
  --warm: rgba(255,220,170,0.95);
  --shade-opacity: 0.10;
  --map-brightness: 0.65;
  --map-contrast: 1.0;
  --map-saturate: 0.0;
}

.leaflet-tile{
  filter:
    grayscale(1)
    brightness(var(--map-brightness))
    contrast(var(--map-contrast))
    saturate(var(--map-saturate));
}

html{ margin:0; }
body{
  margin:0;
  color:var(--text);
  background:linear-gradient(180deg,var(--bg1),var(--bg0));
  font-family:system-ui,-apple-system,"Inter",sans-serif;
  min-height:100dvh;
  display:flex;
  flex-direction:column;
}

/* Layout */
.wrap{
  flex:1;
  display:flex;
  flex-direction:column;
  padding:20px 16px;
}
.content{
  flex:1;
  width:100%;
  max-width:1000px;
  margin:0 auto;

  display:grid;
  grid-template-rows:auto 1fr auto;
  gap:18px;

  min-height:0;
}

/* Cards */
.teleprompter{
  position:relative;
  padding:16px 20px;
  backdrop-filter:blur(20px);
  background:linear-gradient(
    180deg,
    rgba(255,255,255,0.05),
    rgba(255,255,255,0.02)
  );
  border-radius: 22px;
  overflow: hidden; 
}

.mapWrap{
  position:relative;
  overflow:hidden;
  background:#0a0b10;
  display:flex;
  min-height:320px;
  border-radius: 22px;
  overflow: hidden;
}

.teleprompter,
.mapWrap{
  border-radius: 26px;
  box-shadow: 
    0 20px 60px rgba(0,0,0,0.35),
    inset 0 1px 0 rgba(255,255,255,0.05);
}

.mapTint,
.mapShade{
  pointer-events:none;
  position:absolute;
  inset:0;
  z-index:2;
}

.mapTint{
  background: radial-gradient(ellipse at center, rgba(0,0,0,0.05), rgba(0,0,0,0.35));
  mix-blend-mode:multiply;
}
.mapShade{
  background: radial-gradient(ellipse at center, rgba(0,0,0,0.0), rgba(0,0,0,0.55));
}

/* Map */
#map{ flex:1; }

.status,
.hint,
.privacy-hint{
  font-size:13px;
  opacity:0.65;
  margin:4px 0;
}

.hint{
  position:sticky;
  bottom:10px;
}

.leaflet-container{
  background:#0a0b10 !important;
  cursor:crosshair;
}

/* Subtiles Nacht-Softening */
.mapDarkOverlay{
  pointer-events:none;
  position:absolute;
  inset:0;
  z-index:1;
  background: radial-gradient(ellipse at center, rgba(0,0,0,0.05), rgba(0,0,0,0.15));
}

/* Center Control */
.mapCenterControl{
  position:absolute;
  top:25px;
  left:50%;
  transform:translateX(-50%);
  z-index:1000;
}

.world-btn{
  padding:8px 18px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.18);
  background:rgba(0,0,0,0.28);
  color:white;
  font-size:13px;
  cursor:pointer;
  transition:all 0.2s ease;
}
.world-btn:hover{
  background:rgba(255,220,170,0.12);
  border:1px solid rgba(255,220,170,0.35);
}

/* Teleprompter */
.tp-text{
  text-align:center;
  font-size:clamp(16px, 2vw, 24px);
  line-height:1.35;
  min-height:1.8em;
}
.tp-word{ color:var(--ghost); transition:0.2s; }
.tp-word.done{ color:var(--warm); }
.tp-word.active{ color:white; }

.tp-meta{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:14px;
  margin-top:6px;
}

.tp-btn{
  background:transparent;
  border:none;
  opacity:0.5;
  padding:6px 10px;
  color: inherit;
}
.tp-btn:hover{ opacity:1; }

.tp-progress{
  width:min(500px, 60vw);
  height:4px;
  border-radius:6px;
  overflow:hidden;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.08);
  flex:0 1 420px;
}

.tp-progress-bar{
  height:4px;
  width:0%;
  background: linear-gradient(90deg, rgba(255,220,170,0.7), rgba(255,255,255,0.6));
  transition: width 0.6s cubic-bezier(.4,0,.2,1);
}

.tp-actions{
  margin-top:14px;
  min-height:0;
  position:relative;
}
.tp-actions-center{ text-align:center; }
.tp-actions-right{
  position:absolute;
  right:0;
  top:0;
}

.share-btn{
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.12);
  padding:8px 18px;
  font-size:14px;
  border-radius:999px;
  font-weight:500;
  letter-spacing:0.02em;
}

.export-btn{
  background:rgba(255,220,170,0.15);
  border:1px solid rgba(255,220,170,0.35);
  position:absolute;
  bottom:14px;
  right:14px;
  padding:6px 10px;
  font-size:12px;
  border-radius:10px;
  opacity:0.6;
}

/* Footer text */
.status,
.hint,
.privacy-hint{
  text-align:center;
  margin-top:14px;
  font-size:14px;
  opacity:0.7;
}

/* Attribution */
.leaflet-control-attribution{
  background:rgba(0,0,0,0.35) !important;
  color:rgba(255,255,255,0.65);
}

/* Lang badge */
#langBadge{
  position:fixed;
  top:15px;
  left:15px;
  font-size:12px;
  opacity:0.6;
  z-index:2000;
}

.map-actions {
  position:absolute;
  left:16px;      /* ‚Üê statt right */
  bottom:16px;
  z-index:700;
  transition: opacity 200ms ease;
}

.map-actions button{
  padding:12px 22px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.18);
  background: rgba(255,255,255,0.12);
  color:white;
  font-weight:600;
  letter-spacing:0.02em;
  backdrop-filter: blur(10px);
  cursor:pointer;
  transition: all 160ms ease;
}

.map-actions button:hover{
  background: rgba(255,255,255,0.22);
  transform: translateY(-1px);
}
    
.map-actions.disabled {
  opacity: 0.4;
  pointer-events: none;
}
  
  </style>
</head>

<body>

<!-- FIX: existiert jetzt wirklich -->
<div id="langBadge"></div>

<div class="wrap">
  <div class="content">

    <!-- TELEPROMPTER -->
    <div class="teleprompter">
      <p id="tp-text" class="tp-text"></p>

      <div class="tp-meta">
        <button id="tp-prev" class="tp-btn" type="button">‚Üê</button>

        <div class="tp-progress">
          <div class="tp-progress-bar" id="tp-bar"></div>
        </div>

        <button id="tp-next" class="tp-btn" type="button">‚Üí</button>
      </div>

      <div class="tp-actions">
        <div class="tp-actions-center">
          <button id="shareMain" class="tp-btn share-btn" type="button"></button>
        </div>
      </div>
    </div>

    <!-- KARTE -->
    <div class="mapWrap">
     <div id="map"></div>
      <div class="map-actions">
        <button id="btnCard" type="button"></button>
      </div>

      <!-- FIX: overlay existiert jetzt -->
      <div class="mapDarkOverlay"></div>

      <div class="mapTint"></div>
      <div class="mapShade"></div>
    </div>

    <!-- Footer -->
    <p id="privacyHint" class="privacy-hint"></p>
    <p id="status" class="status"></p>
    <p id="hint" class="hint"></p>

  </div>
</div>

<script>
/* -------------------------
   1) Language Detection
-------------------------- */
function getLangFromUrl() {
  const p = new URLSearchParams(location.search);
  const v = (p.get("lang") || "").trim();
  return v ? v.toLowerCase() : null;
}
function normalizeLang(tag) {
  if (!tag) return "en";
  const t = tag.toLowerCase();
  if (t.startsWith("zh")) return "zh";
  if (t.startsWith("in")) return "id";
  if (t.startsWith("iw")) return "he";
  if (t.startsWith("pt")) return "pt";
  return t.split("-")[0];
}
const SUPPORTED = [
  "en","de","es","fr","pt","ru","ar","hi",
  "bn","ur","zh","ja","ko","vi","tr","sw","id"
];
function pickLanguage() {
  const urlLang = normalizeLang(getLangFromUrl());
  if (urlLang && SUPPORTED.includes(urlLang)) return urlLang;

  const prefs = (navigator.languages && navigator.languages.length)
    ? navigator.languages.map(normalizeLang)
    : [normalizeLang(navigator.language || "en")];

  for (const lang of prefs) {
    if (SUPPORTED.includes(lang)) return lang;
  }
  return "en";
}
const LANG = pickLanguage();
document.documentElement.lang = LANG;
const lb = document.getElementById("langBadge");
if (lb) lb.textContent = LANG.toUpperCase();

/* -------------------------
   2) Teleprompter Text
-------------------------- */
const TP = {

  en: [
    "We almost never think about it.",
    "Our lives on this small blue planet in space.",
    "In this brief blink long after the Big Bang.",
    "That we exist at all is ‚Äì as far as we know ‚Äì unique.",
    "That makes us all special. And it connects us.",
    "Place a light ‚Äî and see our shared glow."
  ],

  de: [
    "Wir denken fast nie daran.",
    "Unser Leben auf dieser kleinen blauen Kugel im Weltall.",
    "In diesem Augenzwinkern lange nach dem Urknall.",
    "Dass es uns √ºberhaupt gibt ist ‚Äì nach allem was wir wissen ‚Äì einzigartig.",
    "Das macht uns alle besonders. Und es verbindet uns.",
    "Setze ein Licht ‚Äî und sieh unser gemeinsames Leuchten."
  ],

  es: [
    "Casi nunca pensamos en ello.",
    "Nuestra vida en esta peque√±a esfera azul en el espacio.",
    "En este parpadeo mucho despu√©s del Big Bang.",
    "Que existamos ‚Äì seg√∫n todo lo que sabemos ‚Äì es √∫nico.",
    "Eso nos hace especiales. Y nos conecta.",
    "Coloca una luz ‚Äî y mira nuestro resplandor compartido."
  ],

  fr: [
    "Nous n‚Äôy pensons presque jamais.",
    "√Ä notre vie sur cette petite plan√®te bleue dans l‚Äôespace.",
    "Dans ce clin d‚Äô≈ìil longtemps apr√®s le Big Bang.",
    "Le fait que nous existions ‚Äì selon ce que nous savons ‚Äì est unique.",
    "Cela nous rend particuliers. Et nous relie.",
    "Place une lumi√®re ‚Äî et vois notre lueur partag√©e."
  ],

  pt: [
    "Quase nunca pensamos nisso.",
    "Nossa vida neste pequeno planeta azul no espa√ßo.",
    "Neste breve instante muito depois do Big Bang.",
    "Que existamos ‚Äì pelo que sabemos ‚Äì √© algo √∫nico.",
    "Isso nos torna especiais. E nos conecta.",
    "Coloque uma luz ‚Äî e veja nosso brilho compartilhado."
  ],

  ru: [
    "–ú—ã –ø–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞ –æ–± —ç—Ç–æ–º –Ω–µ –¥—É–º–∞–µ–º.",
    "–û –Ω–∞—à–µ–π –∂–∏–∑–Ω–∏ –Ω–∞ —ç—Ç–æ–π –º–∞–ª–µ–Ω—å–∫–æ–π –≥–æ–ª—É–±–æ–π –ø–ª–∞–Ω–µ—Ç–µ.",
    "–í —ç—Ç–æ–º –∫—Ä–∞—Ç–∫–æ–º –º–≥–Ω–æ–≤–µ–Ω–∏–∏ —Å–ø—É—Å—Ç—è –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –ë–æ–ª—å—à–æ–≥–æ –≤–∑—Ä—ã–≤–∞.",
    "–¢–æ, —á—Ç–æ –º—ã —Å—É—â–µ—Å—Ç–≤—É–µ–º ‚Äì –Ω–∞—Å–∫–æ–ª—å–∫–æ –º—ã –∑–Ω–∞–µ–º ‚Äì —É–Ω–∏–∫–∞–ª—å–Ω–æ.",
    "–≠—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–∞—Å –æ—Å–æ–±–µ–Ω–Ω—ã–º–∏. –ò —Å–æ–µ–¥–∏–Ω—è–µ—Ç –Ω–∞—Å.",
    "–ó–∞–∂–≥–∏ —Å–≤–µ—Ç ‚Äî –∏ —É–≤–∏–¥—å –Ω–∞—à–µ –æ–±—â–µ–µ —Å–∏—è–Ω–∏–µ."
  ],

  ar: [
    "ŸÜÿßÿØÿ±ÿßŸã ŸÖÿß ŸÜŸÅŸÉÿ± ŸÅŸä ÿ∞ŸÑŸÉ.",
    "ŸÅŸä ÿ≠Ÿäÿßÿ™ŸÜÿß ÿπŸÑŸâ Ÿáÿ∞ÿß ÿßŸÑŸÉŸàŸÉÿ® ÿßŸÑÿ£ÿ≤ÿ±ŸÇ ÿßŸÑÿµÿ∫Ÿäÿ±.",
    "ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑŸÇÿµŸäÿ±ÿ© ÿ®ÿπÿØ ÿ≤ŸÖŸÜ ÿ∑ŸàŸäŸÑ ŸÖŸÜ ÿßŸÑÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑÿπÿ∏ŸäŸÖ.",
    "ÿ£ŸÜ Ÿàÿ¨ŸàÿØŸÜÿß ‚Äì ÿ≠ÿ≥ÿ® ŸÖÿß ŸÜÿπÿ±ŸÅ ‚Äì ÿ£ŸÖÿ± ŸÅÿ±ŸäÿØ.",
    "Ÿáÿ∞ÿß Ÿäÿ¨ÿπŸÑŸÜÿß ŸÖŸÖŸäÿ≤ŸäŸÜ. ŸàŸäÿ±ÿ®ÿ∑ŸÜÿß.",
    "ÿ£ÿ∂ŸÅ ŸÜŸàÿ±Ÿãÿß ‚Äî ŸàÿßŸÜÿ∏ÿ± ÿ•ŸÑŸâ ÿ•ÿ¥ÿ±ÿßŸÇŸÜÿß ÿßŸÑŸÖÿ¥ÿ™ÿ±ŸÉ."
  ],

  hi: [
    "‡§π‡§Æ ‡§≤‡§ó‡§≠‡§ó ‡§ï‡§≠‡•Ä ‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§∏‡•ã‡§ö‡§§‡•á‡•§",
    "‡§á‡§∏ ‡§õ‡•ã‡§ü‡•á ‡§®‡•Ä‡§≤‡•á ‡§ó‡•ç‡§∞‡§π ‡§™‡§∞ ‡§π‡§Æ‡§æ‡§∞‡•á ‡§ú‡•Ä‡§µ‡§® ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç‡•§",
    "‡§á‡§∏ ‡§õ‡•ã‡§ü‡•á ‡§∏‡•á ‡§ï‡•ç‡§∑‡§£ ‡§Æ‡•á‡§Ç, ‡§Æ‡§π‡§æ‡§µ‡§ø‡§∏‡•ç‡§´‡•ã‡§ü ‡§ï‡•á ‡§¨‡§π‡•Å‡§§ ‡§¨‡§æ‡§¶‡•§",
    "‡§ï‡§ø ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§Ö‡§∏‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‚Äì ‡§ú‡§ø‡§§‡§®‡§æ ‡§π‡§Æ ‡§ú‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç ‚Äì ‡§Ö‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø ‡§π‡•à‡•§",
    "‡§Ø‡§π ‡§π‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§î‡§∞ ‡§ú‡•ã‡§°‡§º‡§§‡§æ ‡§π‡•à‡•§",
    "‡§è‡§ï ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§∞‡§ñ‡•ã ‚Äî ‡§î‡§∞ ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§∏‡§æ‡§ù‡§æ ‡§â‡§ú‡§æ‡§≤‡§æ ‡§¶‡•á‡§ñ‡•ã‡•§"
  ],

  bn: [
    "‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ï‡¶ñ‡¶®‡ßã‡¶á ‡¶è‡¶ü‡¶æ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶≠‡¶æ‡¶¨‡¶ø ‡¶®‡¶æ‡•§",
    "‡¶è‡¶á ‡¶õ‡ßã‡¶ü ‡¶®‡ßÄ‡¶≤ ‡¶ó‡ßç‡¶∞‡¶π‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶®‡¶ø‡¶Ø‡¶º‡ßá‡•§",
    "‡¶è‡¶á ‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡ßá, ‡¶¨‡¶ø‡¶ó ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶Ø‡¶º‡ßá‡¶∞ ‡¶Ö‡¶®‡ßá‡¶ï ‡¶™‡¶∞‡ßá‡•§",
    "‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶∏‡ßç‡¶§‡¶ø‡¶§‡ßç‡¶¨ ‚Äì ‡¶Ø‡¶§‡¶ü‡ßÅ‡¶ï‡ßÅ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ú‡¶æ‡¶®‡¶ø ‚Äì ‡¶Ö‡¶®‡¶®‡ßç‡¶Ø‡•§",
    "‡¶è‡¶ü‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡ßá ‡¶§‡ßã‡¶≤‡ßá‡•§ ‡¶è‡¶¨‡¶Ç ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßá‡•§",
    "‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ü‡¶≤‡ßã ‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶ì ‚Äî ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ø‡ßå‡¶• ‡¶Ü‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡ßã‡•§"
  ],

  ur: [
    "€ÅŸÖ ÿ™ŸÇÿ±€åÿ®ÿßŸã ⁄©ÿ®⁄æ€å ÿßÿ≥ ⁄©€í ÿ®ÿßÿ±€í ŸÖ€å⁄∫ ŸÜ€Å€å⁄∫ ÿ≥Ÿà⁄Üÿ™€í€î",
    "ÿßÿ≥ ⁄Ü⁄æŸàŸπ€í ŸÜ€åŸÑ€í ÿ≥€åÿßÿ±€í Ÿæÿ± ÿßŸæŸÜ€å ÿ≤ŸÜÿØ⁄Ø€å ⁄©€í ÿ®ÿßÿ±€í ŸÖ€å⁄∫€î",
    "ÿßÿ≥ ŸÖÿÆÿ™ÿµÿ± ŸÑŸÖÿ≠€í ŸÖ€å⁄∫ÿå ÿ®⁄Ø ÿ®€åŸÜ⁄Ø ⁄©€í ÿ®€Åÿ™ ÿ®ÿπÿØ€î",
    "€ÅŸÖÿßÿ±ÿß Ÿàÿ¨ŸàÿØ ‚Äì ÿ¨ÿ™ŸÜÿß €ÅŸÖ ÿ¨ÿßŸÜÿ™€í €Å€å⁄∫ ‚Äì ŸÖŸÜŸÅÿ±ÿØ €Å€í€î",
    "€å€Å €ÅŸÖ€å⁄∫ ÿÆÿßÿµ ÿ®ŸÜÿßÿ™ÿß €Å€í€î ÿßŸàÿ± ÿ¨Ÿà⁄ëÿ™ÿß €Å€í€î",
    "ÿß€å⁄© ÿ±Ÿàÿ¥ŸÜ€å ÿ±Ÿàÿ¥ŸÜ ⁄©ÿ±€å⁄∫ ‚Äî ÿßŸàÿ± €ÅŸÖÿßÿ±ÿß ŸÖÿ¥ÿ™ÿ±⁄©€Å ÿßÿ¨ÿßŸÑÿß ÿØ€å⁄©⁄æ€å⁄∫€î"
  ],

  zh: [
    "Êàë‰ª¨Âá†‰πé‰ªé‰∏çÂéªÊÉ≥Ëøô‰∫õ„ÄÇ",
    "ÂÖ≥‰∫éÊàë‰ª¨Âú®ËøôÈ¢óÂ∞èÂ∞èËìùËâ≤ÊòüÁêÉ‰∏äÁöÑÁîüÊ¥ª„ÄÇ",
    "Âú®ÂÆáÂÆôÂ§ßÁàÜÁÇ∏‰πãÂêéÊº´ÈïøÂ≤ÅÊúà‰∏≠ÁöÑËøô‰∏ÄÁû¨Èó¥„ÄÇ",
    "Êàë‰ª¨ÁöÑÂ≠òÂú®‚Äî‚ÄîÊçÆÊàë‰ª¨ÊâÄÁü•‚Äî‚ÄîÊòØÁã¨‰∏ÄÊó†‰∫åÁöÑ„ÄÇ",
    "ËøôËÆ©Êàë‰ª¨‰∏é‰ºó‰∏çÂêåÔºå‰πüËÆ©Êàë‰ª¨ÂΩºÊ≠§ËøûÊé•„ÄÇ",
    "ÁÇπ‰∫Æ‰∏ÄÁõèÁÅØ ‚Äî‚Äî ÁúãËßÅÊàë‰ª¨ÂÖ±ÂêåÁöÑÂÖâËäí„ÄÇ"
  ],

  ja: [
    "ÁßÅ„Åü„Å°„ÅØ„Åª„Å®„Çì„Å©ËÄÉ„Åà„Åæ„Åõ„Çì„ÄÇ",
    "„Åì„ÅÆÂ∞è„Åï„Å™Èùí„ÅÑÊÉëÊòü„Åß„ÅÆÁßÅ„Åü„Å°„ÅÆÊöÆ„Çâ„Åó„Å´„Å§„ÅÑ„Å¶„ÄÇ",
    "„Éì„ÉÉ„Ç∞„Éê„É≥„Åã„ÇâÈï∑„ÅÑÊôÇÈñì„ÅåÈÅé„Åé„Åü„Åì„ÅÆ‰∏ÄÁû¨„Å´„Å§„ÅÑ„Å¶„ÄÇ",
    "ÁßÅ„Åü„Å°„ÅåÂ≠òÂú®„Åó„Å¶„ÅÑ„Çã„Åì„Å®Ëá™‰Ωì„Åå„ÄÅÁßÅ„Åü„Å°„ÅÆÁü•„ÇãÈôê„ÇäÁâπÂà•„Åß„Åô„ÄÇ",
    "„Åù„Çå„ÅØÁßÅ„Åü„Å°„ÇíÁâπÂà•„Å´„Åó„ÄÅ„Å§„Å™„Åí„Åæ„Åô„ÄÇ",
    "ÂÖâ„ÇíÁÅØ„Åó„Å¶ ‚Äî‚Äî ÁßÅ„Åü„Å°„ÅÆÂÖ±ÈÄö„ÅÆËºù„Åç„ÇíË¶ã„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"
  ],

  ko: [
    "Ïö∞Î¶¨Îäî Í±∞Ïùò ÏÉùÍ∞ÅÌïòÏßÄ ÏïäÏäµÎãàÎã§.",
    "Ïù¥ ÏûëÏùÄ Ìë∏Î•∏ ÌñâÏÑ±ÏóêÏÑúÏùò Ïö∞Î¶¨Ïùò ÏÇ∂Ïóê ÎåÄÌï¥.",
    "ÎπÖÎ±Ö Ïù¥ÌõÑ Ïò§Îûú ÏãúÍ∞ÑÏù¥ ÏßÄÎÇú Ïù¥ ÏßßÏùÄ ÏàúÍ∞ÑÏóê ÎåÄÌï¥.",
    "Ïö∞Î¶¨Ïùò Ï°¥Ïû¨ ÏûêÏ≤¥Í∞Ä Ïö∞Î¶¨Í∞Ä ÏïÑÎäî Ìïú ÌäπÎ≥ÑÌï©ÎãàÎã§.",
    "Í∑∏Í≤ÉÏùÄ Ïö∞Î¶¨Î•º ÌäπÎ≥ÑÌïòÍ≤å ÎßåÎì§Í≥† Ïó∞Í≤∞Ìï©ÎãàÎã§.",
    "ÎπõÏùÑ Î∞ùÌûàÍ≥† ‚Äî Ïö∞Î¶¨Ïùò Í≥µÎèôÏùò ÎπõÏùÑ Î≥¥ÏÑ∏Ïöî."
  ],

  vi: [
    "Ch√∫ng ta h·∫ßu nh∆∞ kh√¥ng bao gi·ªù nghƒ© ƒë·∫øn ƒëi·ªÅu ƒë√≥.",
    "V·ªÅ cu·ªôc s·ªëng c·ªßa m√¨nh tr√™n h√†nh tinh xanh nh·ªè b√© n√†y.",
    "Trong kho·∫£nh kh·∫Øc ng·∫Øn ng·ªßi r·∫•t l√¢u sau V·ª• N·ªï L·ªõn.",
    "Vi·ªác ch√∫ng ta t·ªìn t·∫°i ‚Äì theo nh·ªØng g√¨ ch√∫ng ta bi·∫øt ‚Äì l√† ƒëi·ªÅu ƒë·ªôc nh·∫•t.",
    "ƒêi·ªÅu ƒë√≥ khi·∫øn ch√∫ng ta tr·ªü n√™n ƒë·∫∑c bi·ªát. V√† k·∫øt n·ªëi ch√∫ng ta.",
    "Th·∫Øp m·ªôt √°nh s√°ng ‚Äî v√† nh√¨n th·∫•y √°nh s√°ng chung c·ªßa ch√∫ng ta."
  ],

  tr: [
    "Bunu neredeyse hi√ß d√º≈ü√ºnmeyiz.",
    "Bu k√º√ß√ºk mavi gezegendeki hayatƒ±mƒ±zƒ±.",
    "B√ºy√ºk Patlama‚Äôdan √ßok sonra bu kƒ±sa an i√ßinde.",
    "Var olmamƒ±z ‚Äì bildiƒüimiz kadarƒ±yla ‚Äì benzersizdir.",
    "Bu bizi √∂zel kƒ±lar. Ve birbirimize baƒülar.",
    "Bir ƒ±≈üƒ±k yak ‚Äî ve ortak ƒ±≈üƒ±ƒüƒ±mƒ±zƒ± g√∂r."
  ],

  sw: [
    "Karibu hatufikirii kuhusu hilo.",
    "Kuhusu maisha yetu kwenye sayari hii ndogo ya buluu.",
    "Katika mng‚Äôao huu mfupi muda mrefu baada ya Mlipo Mkuu.",
    "Kwamba tupo ‚Äì kadiri tunavyojua ‚Äì ni ya kipekee.",
    "Hilo hutufanya tuwe wa pekee na hutunganisha.",
    "Weka mwanga ‚Äî na uone mwangaza wetu wa pamoja."
  ],

  id: [
    "Kita hampir tidak pernah memikirkannya.",
    "Tentang kehidupan kita di planet biru kecil ini.",
    "Dalam kedipan singkat lama setelah Dentuman Besar.",
    "Bahwa kita ada ‚Äì sejauh yang kita ketahui ‚Äì adalah sesuatu yang unik.",
    "Hal itu membuat kita istimewa dan menghubungkan kita.",
    "Nyalakan sebuah cahaya ‚Äî dan lihat cahaya bersama kita."
  ]

};

/* -------------------------
   3) UI Text
-------------------------- */
const UI = {

  en: {
    world: "World view",
    card: "Take a picture",
    hint: "Click on the map to place or move your light. (One light per browser.)",
    privacy: "Lights are anonymous and gently rounded to about 10 km.",
    status_empty: "Place your light on the map.",
    status_set: "Your light is glowing. You can move it anytime.",
    status_export: "Capturing the moment‚Ä¶",
    status_done: "Image saved.",
    status_error_load: "Unable to load lights.",
    status_error_save: "Unable to save image."
  },

  de: {
    world: "Weltansicht",
    card: "Moment festhalten",
    hint: "Klicke auf die Karte, um dein Licht zu setzen oder zu verschieben. (Ein Licht pro Browser.)",
    privacy: "Lichter sind anonym und sanft auf etwa 10 km gerundet.",
    status_empty: "Setze dein Licht auf der Karte.",
    status_set: "Dein Licht leuchtet. Du kannst es jederzeit verschieben.",
    status_export: "Moment wird festgehalten‚Ä¶",
    status_done: "Bild gespeichert.",
    status_error_load: "Lichter konnten nicht geladen werden.",
    status_error_save: "Bild konnte nicht gespeichert werden."
  },

  es: {
    world: "Vista mundial",
    card: "Capturar momento",
    hint: "Haz clic en el mapa para colocar o mover tu luz. (Una luz por navegador.)",
    privacy: "Las luces son an√≥nimas y suavemente redondeadas a unos 10 km.",
    status_empty: "Coloca tu luz en el mapa.",
    status_set: "Tu luz est√° brillando. Puedes moverla cuando quieras.",
    status_export: "Capturando el momento‚Ä¶",
    status_done: "Imagen guardada.",
    status_error_load: "No se pudieron cargar las luces.",
    status_error_save: "No se pudo guardar la imagen."
  },

  fr: {
    world: "Vue du monde",
    card: "Capturer l‚Äôinstant",
    hint: "Cliquez sur la carte pour placer ou d√©placer votre lumi√®re. (Une lumi√®re par navigateur.)",
    privacy: "Les lumi√®res sont anonymes et doucement arrondies √† environ 10 km.",
    status_empty: "Placez votre lumi√®re sur la carte.",
    status_set: "Votre lumi√®re brille. Vous pouvez la d√©placer √† tout moment.",
    status_export: "Capture de l‚Äôinstant‚Ä¶",
    status_done: "Image enregistr√©e.",
    status_error_load: "Impossible de charger les lumi√®res.",
    status_error_save: "Impossible d‚Äôenregistrer l‚Äôimage."
  },

  pt: {
    world: "Vis√£o mundial",
    card: "Capturar momento",
    hint: "Clique no mapa para colocar ou mover sua luz. (Uma luz por navegador.)",
    privacy: "As luzes s√£o an√¥nimas e suavemente arredondadas para cerca de 10 km.",
    status_empty: "Coloque sua luz no mapa.",
    status_set: "Sua luz est√° brilhando. Voc√™ pode mov√™-la a qualquer momento.",
    status_export: "Capturando o momento‚Ä¶",
    status_done: "Imagem salva.",
    status_error_load: "N√£o foi poss√≠vel carregar as luzes.",
    status_error_save: "N√£o foi poss√≠vel salvar a imagem."
  },

  ru: {
    world: "–í–∏–¥ –º–∏—Ä–∞",
    card: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–º–µ–Ω—Ç",
    hint: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Å–≤–µ—Ç. (–û–¥–∏–Ω —Å–≤–µ—Ç –Ω–∞ –±—Ä–∞—É–∑–µ—Ä.)",
    privacy: "–û–≥–Ω–∏ –∞–Ω–æ–Ω–∏–º–Ω—ã –∏ –º—è–≥–∫–æ –æ–∫—Ä—É–≥–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä–Ω–æ –¥–æ 10 –∫–º.",
    status_empty: "–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Å–≤–æ–π —Å–≤–µ—Ç –Ω–∞ –∫–∞—Ä—Ç–µ.",
    status_set: "–í–∞—à —Å–≤–µ—Ç —Å–∏—è–µ—Ç. –í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.",
    status_export: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞‚Ä¶",
    status_done: "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.",
    status_error_load: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–≥–Ω–∏.",
    status_error_save: "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ."
  },

  ar: {
    world: "ÿπÿ±ÿ∂ ÿßŸÑÿπÿßŸÑŸÖ",
    card: "ÿßÿ≠ŸÅÿ∏ ÿßŸÑŸÑÿ≠ÿ∏ÿ©",
    hint: "ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ŸÑŸàÿ∂ÿπ ÿßŸÑÿ∂Ÿàÿ° ÿ£Ÿà ÿ™ÿ≠ÿ±ŸäŸÉŸá. (ÿ∂Ÿàÿ° Ÿàÿßÿ≠ÿØ ŸÑŸÉŸÑ ŸÖÿ™ÿµŸÅÿ≠.)",
    privacy: "ÿßŸÑÿ£ÿ∂Ÿàÿßÿ° ŸÖÿ¨ŸáŸàŸÑÿ© ÿßŸÑŸáŸàŸäÿ© ŸàŸÖŸÇÿ±ÿ®ÿ© ÿ®ŸÑÿ∑ŸÅ ÿ•ŸÑŸâ ÿ≠ŸàÿßŸÑŸä 10 ŸÉŸÖ.",
    status_empty: "ÿ∂ÿπ ŸÜŸàÿ±ŸÉ ÿπŸÑŸâ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ©.",
    status_set: "ŸÜŸàÿ±ŸÉ Ÿäÿ∂Ÿäÿ° ÿßŸÑÿ¢ŸÜ. ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ≠ÿ±ŸäŸÉŸá ŸÅŸä ÿ£Ÿä ŸàŸÇÿ™.",
    status_export: "ÿ¨ÿßÿ±Ÿç ÿ≠ŸÅÿ∏ ÿßŸÑŸÑÿ≠ÿ∏ÿ©‚Ä¶",
    status_done: "ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿµŸàÿ±ÿ©.",
    status_error_load: "ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ∂Ÿàÿßÿ°.",
    status_error_save: "ÿ™ÿπÿ∞ÿ± ÿ≠ŸÅÿ∏ ÿßŸÑÿµŸàÿ±ÿ©."
  },

  hi: {
    world: "‡§µ‡§ø‡§∂‡•ç‡§µ ‡§¶‡•É‡§∂‡•ç‡§Ø",
    card: "‡§ï‡•ç‡§∑‡§£ ‡§∏‡§π‡•á‡§ú‡•á‡§Ç",
    hint: "‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§™‡§®‡•Ä ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§∞‡§ñ‡•á‡§Ç ‡§Ø‡§æ ‡§¨‡§¶‡§≤‡•á‡§Ç‡•§ (‡§™‡•ç‡§∞‡§§‡§ø ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§è‡§ï ‡§∞‡•ã‡§∂‡§®‡•Ä.)",
    privacy: "‡§≤‡§æ‡§á‡§ü‡•ç‡§∏ ‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§≤‡§ó‡§≠‡§ó 10 ‡§ï‡§ø‡§Æ‡•Ä ‡§§‡§ï ‡§π‡§≤‡•ç‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ó‡•ã‡§≤ ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡§Ç‡•§",
    status_empty: "‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞ ‡§™‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§∞‡§ñ‡•á‡§Ç‡•§",
    status_set: "‡§Ü‡§™‡§ï‡•Ä ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§ö‡§Æ‡§ï ‡§∞‡§π‡•Ä ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§",
    status_export: "‡§ï‡•ç‡§∑‡§£ ‡§∏‡§π‡•á‡§ú‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶",
    status_done: "‡§ö‡§ø‡§§‡•ç‡§∞ ‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ‡•§",
    status_error_load: "‡§∞‡•ã‡§∂‡§®‡§ø‡§Ø‡§æ‡§Å ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡•Ä‡§Ç‡•§",
    status_error_save: "‡§ö‡§ø‡§§‡•ç‡§∞ ‡§∏‡§π‡•á‡§ú‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ ‡§∏‡§ï‡§æ‡•§"
  },

  bn: {
    world: "‡¶¨‡¶ø‡¶∂‡ßç‡¶¨ ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø",
    card: "‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®",
    hint: "‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶≤‡ßã ‡¶¨‡¶∏‡¶æ‡¶® ‡¶¨‡¶æ ‡¶∏‡¶∞‡¶æ‡¶®‡•§ (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ü‡¶≤‡ßã.)",
    privacy: "‡¶Ü‡¶≤‡ßã ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ó‡ßã‡¶™‡¶®‡ßÄ‡¶Ø‡¶º ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡ßß‡ß¶ ‡¶ï‡¶ø‡¶Æ‡¶ø ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
    status_empty: "‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶≤‡ßã ‡¶¨‡¶∏‡¶æ‡¶®‡•§",
    status_set: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶≤‡ßã ‡¶ú‡ßç‡¶¨‡¶≤‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∏‡¶∞‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§",
    status_export: "‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶",
    status_done: "‡¶õ‡¶¨‡¶ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
    status_error_load: "‡¶Ü‡¶≤‡ßã ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§",
    status_error_save: "‡¶õ‡¶¨‡¶ø ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§"
  },

  ur: {
    world: "ÿπÿßŸÑŸÖ€å ŸÖŸÜÿ∏ÿ±",
    card: "ŸÑŸÖÿ≠€Å ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫",
    hint: "ŸÜŸÇÿ¥€í Ÿæÿ± ⁄©ŸÑ⁄© ⁄©ÿ± ⁄©€í ÿßŸæŸÜ€å ÿ±Ÿàÿ¥ŸÜ€å ÿ±⁄©⁄æ€å⁄∫ €åÿß ŸÖŸÜÿ™ŸÇŸÑ ⁄©ÿ±€å⁄∫€î (€Åÿ± ÿ®ÿ±ÿßÿ§ÿ≤ÿ± ⁄©€í ŸÑ€å€í ÿß€å⁄© ÿ±Ÿàÿ¥ŸÜ€å.)",
    privacy: "ÿ±Ÿàÿ¥ŸÜ€å ⁄ØŸÖŸÜÿßŸÖ €Å€í ÿßŸàÿ± ÿ™ŸÇÿ±€åÿ®ÿßŸã 10 ⁄©ŸÑŸàŸÖ€åŸπÿ± ÿ™⁄© ŸÜÿ±ŸÖ€å ÿ≥€í ⁄ØŸàŸÑ ⁄©€å ⁄Øÿ¶€å €Å€í€î",
    status_empty: "ŸÜŸÇÿ¥€í Ÿæÿ± ÿßŸæŸÜ€å ÿ±Ÿàÿ¥ŸÜ€å ÿ±⁄©⁄æ€å⁄∫€î",
    status_set: "ÿ¢Ÿæ ⁄©€å ÿ±Ÿàÿ¥ŸÜ€å ⁄ÜŸÖ⁄© ÿ±€Å€å €Å€í€î ÿ¢Ÿæ ÿßÿ≥€í ⁄©ÿ≥€å ÿ®⁄æ€å ŸàŸÇÿ™ ŸÖŸÜÿ™ŸÇŸÑ ⁄©ÿ± ÿ≥⁄©ÿ™€í €Å€å⁄∫€î",
    status_export: "ŸÑŸÖÿ≠€Å ŸÖÿ≠ŸÅŸàÿ∏ ⁄©€åÿß ÿ¨ÿß ÿ±€Åÿß €Å€í‚Ä¶",
    status_done: "ÿ™ÿµŸà€åÿ± ŸÖÿ≠ŸÅŸàÿ∏ €ÅŸà ⁄Øÿ¶€å€î",
    status_error_load: "ÿ±Ÿàÿ¥ŸÜ€å ŸÑŸà⁄à ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©€å€î",
    status_error_save: "ÿ™ÿµŸà€åÿ± ŸÖÿ≠ŸÅŸàÿ∏ ŸÜ€Å €ÅŸà ÿ≥⁄©€å€î"
  },

  zh: {
    world: "‰∏ñÁïåËßÜÂõæ",
    card: "‰øùÂ≠òËøô‰∏ÄÂàª",
    hint: "ÁÇπÂáªÂú∞Âõæ‰ª•ÊîæÁΩÆÊàñÁßªÂä®‰Ω†ÁöÑÂÖâÁÇπ„ÄÇÔºàÊØè‰∏™ÊµèËßàÂô®‰∏Ä‰∏™ÂÖâÁÇπ„ÄÇÔºâ",
    privacy: "ÁÅØÂÖâÊòØÂåøÂêçÁöÑÔºåÂπ∂ÊüîÂíåÂú∞ÂõõËàç‰∫îÂÖ•Âà∞Á∫¶10ÂÖ¨Èáå„ÄÇ",
    status_empty: "Âú®Âú∞Âõæ‰∏äÊîæÁΩÆ‰Ω†ÁöÑÂÖâÁÇπ„ÄÇ",
    status_set: "‰Ω†ÁöÑÂÖâÁÇπÊ≠£Âú®Èó™ËÄÄ„ÄÇ‰Ω†ÂèØ‰ª•ÈöèÊó∂ÁßªÂä®ÂÆÉ„ÄÇ",
    status_export: "Ê≠£Âú®‰øùÂ≠òËøô‰∏ÄÂàª‚Ä¶",
    status_done: "ÂõæÁâáÂ∑≤‰øùÂ≠ò„ÄÇ",
    status_error_load: "Êó†Ê≥ïÂä†ËΩΩÂÖâÁÇπ„ÄÇ",
    status_error_save: "Êó†Ê≥ï‰øùÂ≠òÂõæÁâá„ÄÇ"
  },

  ja: {
    world: "‰∏ñÁïåË°®Á§∫",
    card: "„Åì„ÅÆÁû¨Èñì„Çí‰øùÂ≠ò",
    hint: "Âú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂÖâ„ÇíÁΩÆ„ÅÑ„Åü„ÇäÂãï„Åã„Åó„Åü„Çä„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÔºà„Éñ„É©„Ç¶„Ç∂„Åî„Å®„Å´1„Å§Ôºâ",
    privacy: "„É©„Ç§„Éà„ÅØÂåøÂêç„Åß„ÄÅÁ¥Ñ10kmÂçò‰Ωç„Å´„ÇÑ„Çè„Çâ„Åã„Åè‰∏∏„ÇÅ„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
    status_empty: "Âú∞Âõ≥„Å´ÂÖâ„ÇíÁΩÆ„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
    status_set: "„ÅÇ„Å™„Åü„ÅÆÂÖâ„ÅåËºù„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ„ÅÑ„Å§„Åß„ÇÇÂãï„Åã„Åõ„Åæ„Åô„ÄÇ",
    status_export: "„Åì„ÅÆÁû¨Èñì„Çí‰øùÂ≠ò‰∏≠‚Ä¶",
    status_done: "ÁîªÂÉè„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü„ÄÇ",
    status_error_load: "ÂÖâ„ÇíË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ",
    status_error_save: "ÁîªÂÉè„Çí‰øùÂ≠ò„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ"
  },

  ko: {
    world: "ÏÑ∏Í≥Ñ Î≥¥Í∏∞",
    card: "Ïù¥ ÏàúÍ∞Ñ Ï†ÄÏû•",
    hint: "ÏßÄÎèÑÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÎπõÏùÑ ÎÜìÍ±∞ÎÇò Ïù¥ÎèôÌïòÏÑ∏Ïöî. (Î∏åÎùºÏö∞Ï†ÄÎãπ 1Í∞ú)",
    privacy: "ÎπõÏùÄ ÏùµÎ™ÖÏù¥Î©∞ ÏïΩ 10km Îã®ÏúÑÎ°ú Î∂ÄÎìúÎüΩÍ≤å Î∞òÏò¨Î¶ºÎê©ÎãàÎã§.",
    status_empty: "ÏßÄÎèÑÏóê ÎπõÏùÑ ÎÜìÏúºÏÑ∏Ïöî.",
    status_set: "ÎπõÏù¥ ÎπõÎÇòÍ≥† ÏûàÏäµÎãàÎã§. Ïñ∏Ï†úÎì† Ïù¥ÎèôÌï† Ïàò ÏûàÏäµÎãàÎã§.",
    status_export: "Ïù¥ ÏàúÍ∞ÑÏùÑ Ï†ÄÏû• Ï§ë‚Ä¶",
    status_done: "Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.",
    status_error_load: "ÎπõÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.",
    status_error_save: "Ïù¥ÎØ∏ÏßÄÎ•º Ï†ÄÏû•Ìï† Ïàò ÏóÜÏäµÎãàÎã§."
  },

  vi: {
    world: "Ch·∫ø ƒë·ªô xem th·∫ø gi·ªõi",
    card: "L∆∞u kho·∫£nh kh·∫Øc",
    hint: "Nh·∫•p v√†o b·∫£n ƒë·ªì ƒë·ªÉ ƒë·∫∑t ho·∫∑c di chuy·ªÉn √°nh s√°ng. (M·ªôt √°nh s√°ng m·ªói tr√¨nh duy·ªát.)",
    privacy: "C√°c √°nh s√°ng l√† ·∫©n danh v√† ƒë∆∞·ª£c l√†m tr√≤n nh·∫π nh√†ng kho·∫£ng 10 km.",
    status_empty: "ƒê·∫∑t √°nh s√°ng c·ªßa b·∫°n tr√™n b·∫£n ƒë·ªì.",
    status_set: "√Ånh s√°ng c·ªßa b·∫°n ƒëang t·ªèa s√°ng. B·∫°n c√≥ th·ªÉ di chuy·ªÉn n√≥ b·∫•t c·ª© l√∫c n√†o.",
    status_export: "ƒêang l∆∞u kho·∫£nh kh·∫Øc‚Ä¶",
    status_done: "H√¨nh ·∫£nh ƒë√£ ƒë∆∞·ª£c l∆∞u.",
    status_error_load: "Kh√¥ng th·ªÉ t·∫£i √°nh s√°ng.",
    status_error_save: "Kh√¥ng th·ªÉ l∆∞u h√¨nh ·∫£nh."
  },

  tr: {
    world: "D√ºnya g√∂r√ºn√ºm√º",
    card: "Anƒ± kaydet",
    hint: "I≈üƒ±ƒüƒ±nƒ±zƒ± yerle≈ütirmek veya ta≈üƒ±mak i√ßin haritaya tƒ±klayƒ±n. (Tarayƒ±cƒ± ba≈üƒ±na bir ƒ±≈üƒ±k.)",
    privacy: "I≈üƒ±klar anonimdir ve yakla≈üƒ±k 10 km‚Äôye yumu≈üak ≈üekilde yuvarlanƒ±r.",
    status_empty: "Haritaya ƒ±≈üƒ±ƒüƒ±nƒ±zƒ± yerle≈ütirin.",
    status_set: "I≈üƒ±ƒüƒ±nƒ±z parlƒ±yor. ƒ∞stediƒüiniz zaman ta≈üƒ±yabilirsiniz.",
    status_export: "An kaydediliyor‚Ä¶",
    status_done: "G√∂rsel kaydedildi.",
    status_error_load: "I≈üƒ±klar y√ºklenemedi.",
    status_error_save: "G√∂rsel kaydedilemedi."
  },

  sw: {
    world: "Mtazamo wa dunia",
    card: "Hifadhi wakati huu",
    hint: "Bofya ramani ili kuweka au kusogeza mwanga wako. (Mwanga mmoja kwa kivinjari.)",
    privacy: "Taa ni za siri na zimezungushwa kwa upole hadi takriban km 10.",
    status_empty: "Weka mwanga wako kwenye ramani.",
    status_set: "Mwanga wako unang'aa. Unaweza kuusogeza wakati wowote.",
    status_export: "Inahifadhi wakati huu‚Ä¶",
    status_done: "Picha imehifadhiwa.",
    status_error_load: "Imeshindikana kupakia taa.",
    status_error_save: "Imeshindikana kuhifadhi picha."
  },

  id: {
    world: "Tampilan dunia",
    card: "Simpan momen",
    hint: "Klik peta untuk menempatkan atau memindahkan cahaya Anda. (Satu cahaya per browser.)",
    privacy: "Cahaya bersifat anonim dan dibulatkan secara lembut hingga sekitar 10 km.",
    status_empty: "Tempatkan cahaya Anda di peta.",
    status_set: "Cahaya Anda sedang bersinar. Anda bisa memindahkannya kapan saja.",
    status_export: "Menyimpan momen‚Ä¶",
    status_done: "Gambar disimpan.",
    status_error_load: "Tidak dapat memuat cahaya.",
    status_error_save: "Tidak dapat menyimpan gambar."
  }

};

const UI_TEXT = UI[LANG] || UI.en;
const tpTexts = TP[LANG] || TP.en;

document.getElementById("btnCard").textContent  = UI_TEXT.card;
document.getElementById("hint").textContent     = UI_TEXT.hint;
document.getElementById("privacyHint").textContent = UI_TEXT.privacy;

/* -------------------------
   4) Teleprompter
-------------------------- */
const CHAR_BASED_LANGS = ["zh","ja","ko"];
const WORD_MS = (CHAR_BASED_LANGS.includes(LANG) ? 190 : 240);
const SENTENCE_PAUSE = 900;

let tpIndex = 0;
let tpUnitIdx = 0;
let tpTimer = null;

const tpTextEl = document.getElementById("tp-text");
const tpBarEl  = document.getElementById("tp-bar");

function updateProgress(){
  if(!tpBarEl) return;
  tpBarEl.style.width = `${100 * (tpIndex + 1) / tpTexts.length}%`;
}

function renderSentence(sentence){
  const s = (sentence || "").replace(/\n/g, " \n ");
  const tokens = s.split(/(\s+)/);

  tpTextEl.innerHTML = tokens.map(t => {
    if (t === "\n") return `<span class="tp-br"></span>`;
    if (/^\s+$/.test(t)) return `<span class="tp-space">${t}</span>`;
    return `<span class="tp-word">${t}</span>`;
  }).join("");
}

function getUnits(sentence){
  const s = sentence || "";
  if (CHAR_BASED_LANGS.includes(LANG)) {
    return Array.from(s.replace(/\s+/g, ""));
  }
  return s.replace(/\n/g, " ").split(/\s+/).filter(Boolean);
}

function markProgress(activeIdx){
  const wordSpans = Array.from(tpTextEl.querySelectorAll(".tp-word"));
  wordSpans.forEach((w, i) => {
    w.classList.remove("active");
    if (i <= activeIdx) w.classList.add("done");
    else w.classList.remove("done");
  });
  if (wordSpans[activeIdx]) wordSpans[activeIdx].classList.add("active");
}

function playSentence(idx, auto=true){
  clearInterval(tpTimer);
  tpIndex = idx;
  tpUnitIdx = 0;

  renderSentence(tpTexts[tpIndex]);
  updateProgress();
  const units = getUnits(tpTexts[tpIndex]);
  markProgress(0);

  tpTimer = setInterval(() => {
    tpUnitIdx++;
    if (tpUnitIdx < units.length) {
      markProgress(tpUnitIdx);
    } else {
      clearInterval(tpTimer);
      markProgress(Math.max(0, units.length - 1));
      if (auto) {
        setTimeout(() => {
          if (tpIndex < tpTexts.length - 1) playSentence(tpIndex + 1, true);
        }, SENTENCE_PAUSE);
      }
    }
  }, WORD_MS);
}

document.getElementById("tp-prev").addEventListener("click", () => {
  if (tpIndex > 0) playSentence(tpIndex - 1, false);
});
document.getElementById("tp-next").addEventListener("click", () => {
  if (tpIndex < tpTexts.length - 1) playSentence(tpIndex + 1, false);
});
playSentence(0, true);

/* -------------------------
   5) Share
-------------------------- */
const SHARE_MAIN_LABEL = {
  de: "Mit einer Freundin oder einem Freund teilen",
  en: "Share with a friend",
  fr: "Partager avec un ami",
  es: "Compartir con un amigo",
  pt: "Compartilhar com um amigo",
  ru: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–≥–æ–º",
  ar: "ÿ¥ÿßÿ±ŸÉ ŸÖÿπ ÿµÿØŸäŸÇ",
  hi: "‡§ï‡§ø‡§∏‡•Ä ‡§¶‡•ã‡§∏‡•ç‡§§ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç",
  bn: "‡¶è‡¶ï‡¶ú‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®",
  ur: "⁄©ÿ≥€å ÿØŸàÿ≥ÿ™ ⁄©€í ÿ≥ÿßÿ™⁄æ ÿ¥€åÿ¶ÿ± ⁄©ÿ±€å⁄∫",
  zh: "ÂàÜ‰∫´ÁªôÊúãÂèã",
  ja: "Âèã„Å†„Å°„Å®ÂÖ±Êúâ„Åô„Çã",
  ko: "ÏπúÍµ¨ÏôÄ Í≥µÏú†ÌïòÍ∏∞",
  vi: "Chia s·∫ª v·ªõi m·ªôt ng∆∞·ªùi b·∫°n",
  tr: "Bir arkada≈üƒ±nla payla≈ü",
  sw: "Shiriki na rafiki",
  id: "Bagikan dengan seorang teman"
};

const SHARE_TEXT = {

  de: "Setze ein Licht ‚Äì und werde Teil eines Leuchtens, das die Welt erhellt.",

  en: "Place a light ‚Äî and become part of a glow that brightens the world.",

  es: "Coloca una luz ‚Äî y forma parte de un resplandor que ilumina el mundo.",

  fr: "Place une lumi√®re ‚Äî et deviens partie d‚Äôune lueur qui illumine le monde.",

  pt: "Coloque uma luz ‚Äî e torne-se parte de um brilho que ilumina o mundo.",

  ru: "–ó–∞–∂–≥–∏ —Å–≤–µ—Ç ‚Äî –∏ —Å—Ç–∞–Ω—å —á–∞—Å—Ç—å—é —Å–∏—è–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –æ—Å–≤–µ—â–∞–µ—Ç –º–∏—Ä.",

  ar: "ÿ£ÿ∂ŸÅ ŸÜŸàÿ±Ÿãÿß ‚Äî ŸàŸÉŸÜ ÿ¨ÿ≤ÿ°Ÿãÿß ŸÖŸÜ ÿ•ÿ¥ÿ±ÿßŸÇÿ©Ÿç ÿ™ŸèŸÜŸäÿ± ÿßŸÑÿπÿßŸÑŸÖ.",

  hi: "‡§è‡§ï ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§∞‡§ñ‡•ã ‚Äî ‡§î‡§∞ ‡§â‡§∏ ‡§â‡§ú‡§æ‡§≤‡•á ‡§ï‡§æ ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§¨‡§®‡•ã ‡§ú‡•ã ‡§¶‡•Å‡§®‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§∞‡•ã‡§∂‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§",

  bn: "‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ü‡¶≤‡ßã ‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶ì ‚Äî ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßá‡¶á ‡¶Ü‡¶≤‡ßã‡¶∞ ‡¶Ö‡¶Ç‡¶∂ ‡¶π‡¶ì ‡¶Ø‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶ï‡ßá ‡¶Ü‡¶≤‡ßã‡¶ï‡¶ø‡¶§ ‡¶ï‡¶∞‡ßá‡•§",

  ur: "ÿß€å⁄© ÿ±Ÿàÿ¥ŸÜ€å ÿ±Ÿàÿ¥ŸÜ ⁄©ÿ±€å⁄∫ ‚Äî ÿßŸàÿ± ÿßŸèÿ≥ ÿßÿ¨ÿßŸÑ€í ⁄©ÿß ÿ≠ÿµ€Å ÿ®ŸÜ€å⁄∫ ÿ¨Ÿà ÿØŸÜ€åÿß ⁄©Ÿà ÿ±Ÿàÿ¥ŸÜ ⁄©ÿ±ÿ™ÿß €Å€í€î",

  zh: "ÁÇπ‰∫Æ‰∏ÄÁõèÁÅØ ‚Äî‚Äî Êàê‰∏∫ÁÖß‰∫Æ‰∏ñÁïåÁöÑÂÖâËäíÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ",

  ja: "ÂÖâ„ÇíÁÅØ„Åó„ÄÅ‰∏ñÁïå„ÇíÁÖß„Çâ„ÅôËºù„Åç„ÅÆ‰∏ÄÈÉ®„Å´„Å™„Çç„ÅÜ„ÄÇ",

  ko: "ÎπõÏùÑ Î∞ùÌûàÍ≥†, ÏÑ∏ÏÉÅÏùÑ Î∞ùÌûàÎäî ÎπõÏùò ÏùºÎ∂ÄÍ∞Ä ÎêòÏñ¥Î≥¥ÏÑ∏Ïöî.",

  vi: "Th·∫Øp m·ªôt √°nh s√°ng ‚Äî v√† tr·ªü th√†nh m·ªôt ph·∫ßn c·ªßa √°nh s√°ng ƒëang l√†m r·∫°ng r·ª° th·∫ø gi·ªõi.",

  tr: "Bir ƒ±≈üƒ±k yak ‚Äî ve d√ºnyayƒ± aydƒ±nlatan bir parƒ±ltƒ±nƒ±n par√ßasƒ± ol.",

  sw: "Weka mwanga ‚Äî na uwe sehemu ya mwangaza unaoangaza dunia.",

  id: "Nyalakan sebuah cahaya ‚Äî dan jadilah bagian dari sinar yang menerangi dunia."

};

function shareUrlForLang() {
  return `${location.origin}/?lang=${encodeURIComponent(LANG)}`;
}

function createShareOverlay(url, text) {

  const encodedFull = encodeURIComponent(text + " " + url);
  const encodedUrl  = encodeURIComponent(url);

  const overlay = document.createElement("div");
  overlay.style.position = "fixed";
  overlay.style.inset = "0";
  overlay.style.background = "rgba(0,0,0,0.55)";
  overlay.style.backdropFilter = "blur(10px)";
  overlay.style.display = "flex";
  overlay.style.alignItems = "center";
  overlay.style.justifyContent = "center";
  overlay.style.zIndex = "6000";

  const box = document.createElement("div");
  box.style.background = "rgba(20,20,25,0.96)";
  box.style.padding = "32px";
  box.style.borderRadius = "28px";
  box.style.display = "flex";
  box.style.gap = "22px";
  box.style.boxShadow = "0 40px 100px rgba(0,0,0,0.7)";
  box.style.animation = "fadeIn 0.25s ease";

  function iconButton(color, href, svg) {
    const a = document.createElement("a");
    a.href = href;
    a.target = "_blank";
    a.rel = "noopener";
    a.style.width = "56px";
    a.style.height = "56px";
    a.style.borderRadius = "50%";
    a.style.background = color;
    a.style.display = "flex";
    a.style.alignItems = "center";
    a.style.justifyContent = "center";
    a.style.transition = "all 0.2s ease";
    a.style.boxShadow = "0 10px 25px rgba(0,0,0,0.4)";
    a.innerHTML = svg;

    a.onmouseenter = () => {
      a.style.transform = "translateY(-4px) scale(1.08)";
    };
    a.onmouseleave = () => {
      a.style.transform = "translateY(0) scale(1)";
    };

    return a;
  }

  // WhatsApp
  box.appendChild(iconButton(
    "#25D366",
    `https://wa.me/?text=${encodedFull}`,
    `<svg width="26" height="26" fill="white" viewBox="0 0 24 24">
      <path d="M20.52 3.48A11.76 11.76 0 0012.02 0C5.38 0 0 5.38 0 12.02c0 2.12.55 4.12 1.52 5.87L0 24l6.27-1.64a11.9 11.9 0 005.75 1.47h.01c6.64 0 12.02-5.38 12.02-12.02 0-3.2-1.25-6.21-3.53-8.33z"/>
    </svg>`
  ));

  // Telegram
  box.appendChild(iconButton(
    "#229ED9",
    `https://t.me/share/url?url=${encodedUrl}&text=${encodeURIComponent(text)}`,
    `<svg width="26" height="26" fill="white" viewBox="0 0 24 24">
      <path d="M9.99 15.88l-.4 5.6c.57 0 .82-.25 1.13-.55l2.7-2.6 5.6 4.08c1.02.56 1.75.27 2.01-.95l3.65-17.14.01-.01c.32-1.5-.54-2.08-1.53-1.7L1.5 9.67c-1.47.57-1.45 1.4-.25 1.77l5.4 1.68 12.53-7.9c.59-.36 1.13-.16.69.2"/>
    </svg>`
  ));

  // Facebook
  box.appendChild(iconButton(
    "#1877F2",
    `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
    `<svg width="26" height="26" fill="white" viewBox="0 0 24 24">
      <path d="M22 12a10 10 0 10-11.63 9.87v-6.99H7.9V12h2.47V9.8c0-2.44 1.46-3.8 3.7-3.8 1.07 0 2.19.19 2.19.19v2.41h-1.23c-1.21 0-1.59.75-1.59 1.52V12h2.7l-.43 2.88h-2.27v6.99A10 10 0 0022 12z"/>
    </svg>`
  ));

  // Copy
  const copyBtn = iconButton(
    "#4CAF50",
    "#",
    `<svg width="26" height="26" fill="white" viewBox="0 0 24 24">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v12h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14h13c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2z"/>
    </svg>`
  );

  copyBtn.onclick = async (e) => {
    e.preventDefault();
    await navigator.clipboard.writeText(url);
    copyBtn.style.background = "#2ecc71";
    setTimeout(() => overlay.remove(), 900);
  };

  box.appendChild(copyBtn);

  overlay.appendChild(box);

  overlay.onclick = (e) => {
    if (e.target === overlay) overlay.remove();
  };

  document.body.appendChild(overlay);
}

function initShareButton() {

  const btn = document.getElementById("shareMain");
  if (!btn) return;

  btn.textContent = SHARE_MAIN_LABEL[LANG] || SHARE_MAIN_LABEL.en;

  btn.onclick = async function () {

    const url   = shareUrlForLang();
    const text  = SHARE_TEXT[LANG] || SHARE_TEXT.en;
    const title = "Together We Are One";

    // Mobile ‚Üí Native Share
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    if (isMobile && navigator.share) {
      try {
        await navigator.share({ title, text, url });
        return;
      } catch (err) {
        if (err?.name === "AbortError") return;
      }
    }

    // Desktop ‚Üí Modern overlay
    createShareOverlay(url, text);
  };
}

initShareButton();
/* -------------------------
   6) Supabase + Status
-------------------------- */
function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

const SUPABASE_URL = 'https://gwfqdukbcgtcefqtgnbl.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3ZnFkdWtiY2d0Y2VmcXRnbmJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MDU2MTMsImV4cCI6MjA4NDI4MTYxM30.ePyuDxhVoc1ol5lQ8JbRKaybgpEPozBR3Wf71oFj040';

const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let session = localStorage.getItem('myLightSession');
if(!session){
  session = uuidv4();
  localStorage.setItem('myLightSession', session);
}

const statusEl = document.getElementById("status");
function setStatus(key){
  const v = UI_TEXT[key] || key || "";
  if (statusEl) statusEl.textContent = v;
}

/* -------------------------
   7) Map
-------------------------- */
const WORLD_BOUNDS = L.latLngBounds(L.latLng(-60, -180), L.latLng(85, 180));
const WORLD_VIEW = { center: [20, 0], zoom: 2.0 };

function afterTwoFrames(fn){ requestAnimationFrame(() => requestAnimationFrame(fn)); }

const map = L.map('map', {
  zoomControl: true,
  preferCanvas: true,
  worldCopyJump: false,
  zoomSnap: 0.25,
  zoomDelta: 0.25,
  maxBounds: WORLD_BOUNDS,
  maxBoundsViscosity: 1.0
});

const canvasRenderer = L.canvas({ padding: 0.5 });
const lightsLayer = L.layerGroup().addTo(map);

function addLight(latlng, isMine=false){
  L.circleMarker(latlng, {
    renderer: canvasRenderer,
    radius: isMine ? 2.6 : 1.35,
    stroke: false,
    fill: true,
    fillOpacity: isMine ? 0.95 : 0.70,
    fillColor: "rgba(255,250,245,1)",
    interactive: isMine
  }).addTo(lightsLayer);
}

map.setView(WORLD_VIEW.center, WORLD_VIEW.zoom, { animate: false });
function goWorld(animate = false){
  map.fitBounds(WORLD_BOUNDS, {
    animate,
    padding: [0, 0]
  });
}

map.whenReady(() => {
  afterTwoFrames(() => {
    map.invalidateSize(true);
    goWorld();
  });
});
window.addEventListener("pageshow", () => {
  afterTwoFrames(() => {
    map.invalidateSize(true);
    goWorld();
  });
});

let _resizeT = null;
window.addEventListener("resize", () => {
  clearTimeout(_resizeT);
  _resizeT = setTimeout(() => map.invalidateSize(true), 150);
});

const voyagerTiles = L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',
  { attribution: '&copy; OpenStreetMap &copy; CARTO', maxZoom: 18, noWrap: true, bounds: WORLD_BOUNDS, crossOrigin: true }
).addTo(map);

const exportTiles = L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png',
  { attribution: '&copy; OpenStreetMap &copy; CARTO', maxZoom: 18, noWrap: true, bounds: WORLD_BOUNDS, crossOrigin: true }
);

let myExactLatLng = null;

function anonymize(lat, lng) {
  const GRID = 0.1;
  return { lat: Math.round(lat / GRID) * GRID, lng: Math.round(lng / GRID) * GRID };
}

const ghost = L.circleMarker([0,0], { radius: 10, stroke: false, fill: true, fillOpacity: 0.0, fillColor: "rgba(255,220,170,1)", interactive: false }).addTo(map);
const ghostCore = L.circleMarker([0,0], { radius: 2.2, stroke: false, fill: true, fillOpacity: 0.0, fillColor: "rgba(255,250,245,1)", interactive: false }).addTo(map);

map.on("mouseover", () => { ghost.setStyle({ fillOpacity: 0.10 }); ghostCore.setStyle({ fillOpacity: 0.75 }); });
map.on("mouseout",  () => { ghost.setStyle({ fillOpacity: 0.0  }); ghostCore.setStyle({ fillOpacity: 0.0  }); });
map.on("mousemove", (e) => { ghost.setLatLng(e.latlng); ghostCore.setLatLng(e.latlng); });

async function loadMyLight(){
  const { data } = await sb.from('lights').select('*').eq('session', session).maybeSingle();
  return data;
}

let allLightPoints = [];

async function loadLights(){
  try{
    const { data, error } = await sb.from('lights').select('*');
    if(error) throw error;

    lightsLayer.clearLayers();

    let mine = null;

    for(const row of (data || [])){
      const isMine = (row.session === session);
      if(isMine) mine = row;

      if (isMine && myExactLatLng)
        addLight([myExactLatLng.lat, myExactLatLng.lng], true);
      else
        addLight([row.lat, row.lng], isMine);
    }

    allLightPoints = data || [];

    const hintEl = document.getElementById("hint");
    const actions = document.querySelector(".map-actions");

    if (mine) {
      if (hintEl) hintEl.style.display = "none";
      setStatus("status_set");
      if (actions) actions.style.opacity = "1";
    } else {
      if (hintEl) hintEl.style.display = "block";
      setStatus("status_empty");
      if (actions) actions.style.opacity = "0.5";
    }

  } catch(e){
    console.error(e);
    setStatus("status_error_load");
  }
}

map.on('click', async (e) => {
  try {
    const clickedLatLng = e.latlng;
    const anonymized = anonymize(clickedLatLng.lat, clickedLatLng.lng);
    myExactLatLng = clickedLatLng;

    const existing = await loadMyLight();

    if(existing){
      await sb.from('lights').update({ lat: anonymized.lat, lng: anonymized.lng }).eq('session', session);
    } else {
      await sb.from('lights').insert({ lat: anonymized.lat, lng: anonymized.lng, session });
    }

    await loadLights();
  } catch(err){
    console.error(err);
  }
});

/* -------------------------
   8) Export
-------------------------- */

document.getElementById("btnCard").addEventListener("click", async () => {
  try {

    setStatus("status_export");

    // üåç Welt exakt fitten
    goWorld(false);
    await waitMoveEnd(map);
    map.invalidateSize(true);

    await new Promise(r =>
      requestAnimationFrame(() =>
        requestAnimationFrame(r)
      )
    );

    if (map.hasLayer(voyagerTiles)) {
      map.removeLayer(voyagerTiles);
    }

    exportTiles.addTo(map);
    await waitTiles(exportTiles);

    map.removeLayer(lightsLayer);

    const exportLayer = L.layerGroup();
    for (const row of allLightPoints) {
      const isMine = row.session === session;

      L.circleMarker([row.lat, row.lng], {
        radius: isMine ? 2.6 : 1.35,
        stroke: false,
        fill: true,
        fillOpacity: isMine ? 0.95 : 0.70,
        fillColor: "rgba(255,250,245,1)"
      }).addTo(exportLayer);
    }

    exportLayer.addTo(map);

    await new Promise(r =>
      requestAnimationFrame(() =>
        requestAnimationFrame(r)
      )
    );

    const tiles = document.querySelectorAll(".leaflet-tile");
    tiles.forEach(t => t.style.filter = "none");

    const overlay = document.querySelector(".mapDarkOverlay");
    if (overlay) overlay.style.display = "none";

    await new Promise(r =>
      requestAnimationFrame(() =>
        requestAnimationFrame(r)
      )
    );

    leafletImage(map, function(err, canvas){

      // restore
      tiles.forEach(t => t.style.filter = "");
      if (overlay) overlay.style.display = "";

      map.removeLayer(exportLayer);
      lightsLayer.addTo(map);
      map.removeLayer(exportTiles);
      voyagerTiles.addTo(map);

      if(err){
        console.error(err);
        setStatus("status_error_save");
        return;
      }

      const link = document.createElement("a");
      link.href = canvas.toDataURL("image/png");
      link.download = "together-we-are-one.png";
      link.click();

      setStatus("status_done");
    });

  } catch(e){
    console.error(e);
    setStatus("status_error_save");
  }
});

/* -------------------------
   9) Start
-------------------------- */
loadLights();
setInterval(loadLights, 30000);
</script>
</body>
</html>
