<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Together We Are One</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- PNG Export helper -->
  <script src="https://unpkg.com/leaflet-image@0.4.0/leaflet-image.js"></script>

  <!-- Open Graph / WhatsApp / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Together We Are One">
  <meta property="og:description" content="A quiet place. You set a light and see that many feel the same.">
  <meta property="og:image" content="https://togetherweareone.earth/TogetherWeAreOneEarth.jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">
  <meta property="og:url" content="https://togetherweareone.earth/">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://togetherweareone.earth/TogetherWeAreOneEarth.jpeg">

  <style>
    :root{
      --bg0:#0b0d12;
      --bg1:#121526;
      --card: rgba(255,255,255,0.06);
      --card2: rgba(255,255,255,0.08);
      --stroke: rgba(255,255,255,0.10);

      --ghost: rgba(255,255,255,0.22);
      --text: rgba(255,255,255,0.92);
      --warm: rgba(255,220,170,0.95);

      --map-brightness: 0.64;
      --map-contrast: 1.25;
      --map-saturate: 0.0;
      --shade-opacity: 0.90;
      --ocean-tint: rgba(0,0,0,0.38);
    }

    html,body { height:100%; }
    body{
      margin:0;
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 50% 12%, rgba(40,60,110,0.35) 0%, rgba(0,0,0,0) 55%),
        radial-gradient(900px 520px at 20% 8%, rgba(130,90,40,0.18) 0%, rgba(0,0,0,0) 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", "Inter", "Segoe UI", Arial, sans-serif;
      overflow-x:hidden;
    }

    .wrap{
      min-height:100%;
      display:grid;
      grid-template-rows:auto auto 1fr auto;
      gap:14px;
      padding:18px 14px;
      box-sizing:border-box;
      max-width:1100px;
      margin:0 auto;
    }

    /* --- Prompter --- */
    .teleprompter{
      padding:18px 18px 14px 18px;
      border-radius:20px;
      background: linear-gradient(180deg, var(--card2), var(--card));
      border: 1px solid var(--stroke);
      box-shadow: 0 16px 60px rgba(0,0,0,0.35);
      backdrop-filter: blur(10px);
    }

    .tp-text{
      text-align:center;
      font-size: clamp(18px, 2.5vw, 30px);
      line-height:1.45;
      letter-spacing:0.2px;
      margin:0;
      padding:8px 10px 10px 10px;
      min-height:3.2em;
      overflow-wrap:anywhere;
      word-break: normal;
    }

    .tp-word{
      color: var(--ghost);
      transition: color 160ms ease, filter 160ms ease;
      white-space: normal;
      overflow-wrap:anywhere;
      word-break: normal;
    }
    .tp-space{ white-space: pre; }
    .tp-word.done{
      color: var(--warm);
      filter: drop-shadow(0 0 12px rgba(255,210,140,0.18));
    }
    .tp-word.active{
      color: rgba(255,245,235,0.98);
      filter: drop-shadow(0 0 18px rgba(255,210,140,0.26));
    }
    .tp-br{
      display:block;
      height: 0.35em;
    }

    .tp-meta{
      display:flex; align-items:center; justify-content:center;
      gap:10px; margin-top:8px; user-select:none;
    }
    .tp-btn{
      width:42px; height:42px; border-radius:14px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.85);
      cursor:pointer;
      transition: background 140ms ease, transform 140ms ease;
      font-size:18px; font-weight:700;
    }
    .tp-btn:hover{ background: rgba(255,255,255,0.10); transform: translateY(-1px); }

    .tp-progress{
      width: min(520px, 62vw);
      height:8px;
      border-radius:8px;
      overflow:hidden;
      background: rgba(255,255,255,0.10);
      border:1px solid rgba(255,255,255,0.08);
    }
    .tp-progress-bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(255,220,170,0.65), rgba(255,255,255,0.55));
      transition: width 220ms ease;
    }

    /* Single Share Button */
    .share-single{
      display:flex;
      justify-content:center;
      margin-top:12px;
    }
    .share-main-btn{
      padding:14px 22px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.92);
      font-size:14px;
      font-weight:500;
      letter-spacing:0.02em;
      cursor:pointer;
      backdrop-filter: blur(10px);
      transition: background 160ms ease, transform 160ms ease, box-shadow 160ms ease;
    }
    .share-main-btn:hover{
      background: rgba(255,255,255,0.14);
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    }
    .share-main-btn:active{
      transform: translateY(0);
      box-shadow:none;
    }

    /* --- Map --- */
    .mapWrap{
      position:relative;
      border-radius:20px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.10);
      box-shadow: 0 16px 60px rgba(0,0,0,0.35);
      background:#0a0b10;
    }

    /* IMPORTANT: keep Leaflet ABOVE the tint overlays */
    #map{
      width:100%;
      height: min(62vh, 520px);
      position:relative;
      z-index: 2;
    }
    #map, #map *{ cursor: crosshair !important; }

    /* Overlays BELOW Leaflet so they don't hide tiny dots */
    .mapTint, .mapShade{
      pointer-events:none;
      position:absolute; inset:0;
      z-index: 1;
    }

    .leaflet-tile{
      filter:
        grayscale(1)
        brightness(var(--map-brightness))
        contrast(var(--map-contrast))
        saturate(var(--map-saturate));
    }

    .mapTint{
      background: var(--ocean-tint);
      mix-blend-mode: multiply;
      opacity:1;
    }
    .mapShade{
      opacity: var(--shade-opacity);
      background:
        radial-gradient(900px 420px at 50% 10%, rgba(0,0,0,0.18), rgba(0,0,0,0.86) 65%),
        radial-gradient(700px 520px at 10% 80%, rgba(0,0,0,0.12), rgba(0,0,0,0.78) 72%),
        linear-gradient(180deg, rgba(0,0,0,0.14), rgba(0,0,0,0.70));
      mix-blend-mode: multiply;
    }

    .hud{
      position:absolute;
      left:12px; top:12px;
      display:flex; gap:10px;
      z-index: 3; /* above everything */
      flex-wrap:wrap;
      align-items:center;
    }
    .hud button{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.24);
      color: rgba(255,255,255,0.92);
      cursor:pointer;
      backdrop-filter: blur(10px);
      transition: background 140ms ease, transform 140ms ease;
      font-weight:650;
      letter-spacing:0.2px;
    }
    .hud button:hover{ background: rgba(0,0,0,0.32); transform: translateY(-1px); }
    .hud button:disabled{ opacity:0.55; cursor:default; transform:none; }

    .hint{
      margin-top: 6px;
      margin-bottom: 0;
      text-align:center;
      color: rgba(255,255,255,0.60);
      font-size:14px;
      transition: opacity 300ms ease;
    }
    .hint.hidden{
      opacity:0;
      pointer-events:none;
      height:0;
      margin:0;
      overflow:hidden;
    }
    .status{
      margin-top: 4px;
      margin-bottom: 0;
      text-align: center;
      color: rgba(255,255,255,0.70);
      font-size: 13px;
    }
    .privacy-hint{
      margin-top: 10px;
      text-align:center;
      font-size:12px;
      color: rgba(255,255,255,0.55);
    }

    @media (max-width:600px){
      .wrap{ padding:12px 10px; }
      .teleprompter{ padding:14px 12px 12px 12px; border-radius:18px; }
      .tp-btn{ width:40px; height:40px; border-radius:14px; }
      #map{ height:52vh; }
    }

    #langBadge{
      position: fixed;
      left: 10px;
      top: 10px;
      z-index: 9999;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.85);
      font: 600 12px/1 ui-sans-serif, system-ui, -apple-system, "Inter", "Segoe UI", Arial, sans-serif;
      letter-spacing: 0.08em;
      backdrop-filter: blur(8px);
    }
  </style>
</head>

<body>
  <div id="langBadge" aria-label="Language"></div>

  <div class="wrap">
    <div class="teleprompter" aria-label="Text">
      <p class="tp-text" id="tp-text"></p>

      <div class="tp-meta">
        <button class="tp-btn" id="tp-prev" title="Previous" aria-label="Previous">‚Üê</button>
        <div class="tp-progress"><div class="tp-progress-bar" id="tp-bar"></div></div>
        <button class="tp-btn" id="tp-next" title="Next" aria-label="Next">‚Üí</button>
      </div>

      <div class="share-single">
        <button id="shareMain" class="share-main-btn" type="button"></button>
      </div>
    </div>

    <div class="mapWrap" id="mapWrap">
      <div class="hud">
        <button id="btnWorld" type="button"></button>
        <button id="btnCard" type="button"></button>
      </div>

      <div id="map"></div>
      <div class="mapTint"></div>
      <div class="mapShade"></div>
    </div>

    <p class="hint" id="hint"></p>
    <p class="status" id="status"></p>
    <p class="privacy-hint" id="privacyHint"></p>
  </div>

<script>
/* -------------------------
   Globals
-------------------------- */
let allLightPoints = []; // IMPORTANT: global (used by export)

/* -------------------------
   1) Language
-------------------------- */
function getLangFromUrl() {
  const p = new URLSearchParams(location.search);
  const v = (p.get("lang") || "").trim();
  return v ? v.toLowerCase() : null;
}
function normalizeLang(tag) {
  if (!tag) return "en";
  const t = tag.toLowerCase();
  if (t.startsWith("zh")) return "zh";
  if (t.startsWith("in")) return "id";
  if (t.startsWith("iw")) return "he";
  if (t.startsWith("pt")) return "pt";
  return t.split("-")[0];
}
const SUPPORTED = ["en","de","es","fr","pt","ru","ar","hi","bn","ur","zh","ja","ko","vi","tr","sw","id"];

function pickLanguage() {
  const urlLang = normalizeLang(getLangFromUrl());
  if (urlLang && SUPPORTED.includes(urlLang)) return urlLang;

  const prefs = (navigator.languages && navigator.languages.length)
    ? navigator.languages.map(normalizeLang)
    : [normalizeLang(navigator.language || "en")];

  for (const lang of prefs) if (SUPPORTED.includes(lang)) return lang;
  return "en";
}
const LANG = pickLanguage();
document.documentElement.lang = LANG;
const badge = document.getElementById("langBadge");
if (badge) badge.textContent = LANG.toUpperCase();

/* -------------------------
   2) Texts
-------------------------- */
const TP = {
  de: [
    "Wir denken fast nie daran.",
    "Unser Leben\nauf dieser kleinen blauen Kugel im Weltall.",
    "In diesem Augenzwinkern\nlange nach dem Urknall.",
    "Es ist ‚Äì\nnach all unserem Wissen ‚Äì\neinzigartig.",
    "Das macht uns alle besonders.\nUnd es verbindet uns.",
    "Hier kannst du ein Licht setzen.\nUnd sehen,\ndass viele dasselbe f√ºhlen."
  ],
  en: [
    "We almost never think about it.",
    "Our lives\non this small blue planet in space.",
    "In this brief blink\nlong after the Big Bang.",
    "That it exists at all ‚Äì\nas far as we know ‚Äì\nis unique.",
    "That makes us all special.\nAnd it connects us.",
    "Here you can place a light.\nAnd see\nthat many feel the same."
  ],
  es: [
    "Casi nunca pensamos en ello.",
    "Nuestra vida\nen esta peque√±a esfera azul en el espacio.",
    "En este parpadeo fugaz\nmucho despu√©s del Big Bang.",
    "Que exista ‚Äì\nseg√∫n todo lo que sabemos ‚Äì\nes √∫nico.",
    "Eso nos hace especiales a todos.\nY nos conecta.",
    "Aqu√≠ puedes colocar una luz.\nY ver\nque muchos sienten lo mismo."
  ],
  fr: [
    "Nous n‚Äôy pensons presque jamais.",
    "√Ä notre vie\nsur cette petite plan√®te bleue dans l‚Äôespace.",
    "Dans ce clin d‚Äô≈ìil fugace\nlongtemps apr√®s le Big Bang.",
    "Le fait que cela existe ‚Äì\nselon ce que nous savons ‚Äì\nest unique.",
    "Cela nous rend tous particuliers.\nEt nous relie.",
    "Ici, tu peux placer une lumi√®re.\nEt voir\nque beaucoup ressentent la m√™me chose."
  ],
  pt: [
    "Quase nunca pensamos nisso.",
    "Na nossa vida\nneste pequeno planeta azul no espa√ßo.",
    "Neste breve piscar de olhos\nmuito depois do Big Bang.",
    "Que isso exista ‚Äì\npelo que sabemos ‚Äì\n√© √∫nico.",
    "Isso nos torna especiais.\nE nos conecta.",
    "Aqui voc√™ pode colocar uma luz.\nE ver\nque muitos sentem o mesmo."
  ],
  ru: [
    "–ú—ã –ø–æ—á—Ç–∏ –Ω–∏–∫–æ–≥–¥–∞ –æ–± —ç—Ç–æ–º –Ω–µ –¥—É–º–∞–µ–º.",
    "–û –Ω–∞—à–µ–π –∂–∏–∑–Ω–∏\n–Ω–∞ —ç—Ç–æ–π –º–∞–ª–µ–Ω—å–∫–æ–π –≥–æ–ª—É–±–æ–π –ø–ª–∞–Ω–µ—Ç–µ –≤ –∫–æ—Å–º–æ—Å–µ.",
    "–í —ç—Ç–æ–º –∫–æ—Ä–æ—Ç–∫–æ–º –º–≥–Ω–æ–≤–µ–Ω–∏–∏\n—Å–ø—É—Å—Ç—è –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –ë–æ–ª—å—à–æ–≥–æ –≤–∑—Ä—ã–≤–∞.",
    "–¢–æ, —á—Ç–æ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äì\n–Ω–∞—Å–∫–æ–ª—å–∫–æ –º—ã –∑–Ω–∞–µ–º ‚Äì\n—É–Ω–∏–∫–∞–ª—å–Ω–æ.",
    "–≠—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–∞—Å –≤—Å–µ—Ö –æ—Å–æ–±–µ–Ω–Ω—ã–º–∏.\n–ò —Å–æ–µ–¥–∏–Ω—è–µ—Ç –Ω–∞—Å.",
    "–ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –∑–∞–∂–µ—á—å —Å–≤–µ—Ç.\n–ò —É–≤–∏–¥–µ—Ç—å,\n—á—Ç–æ –º–Ω–æ–≥–∏–µ —á—É–≤—Å—Ç–≤—É—é—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ."
  ],
  ar: [
    "ŸÜÿßÿØÿ±Ÿãÿß ŸÖÿß ŸÜŸÅŸÉÿ± ŸÅŸä ÿ∞ŸÑŸÉ.",
    "ŸÅŸä ÿ≠Ÿäÿßÿ™ŸÜÿß\nÿπŸÑŸâ Ÿáÿ∞ÿß ÿßŸÑŸÉŸàŸÉÿ® ÿßŸÑÿ£ÿ≤ÿ±ŸÇ ÿßŸÑÿµÿ∫Ÿäÿ± ŸÅŸä ÿßŸÑŸÅÿ∂ÿßÿ°.",
    "ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑŸÑŸÖÿ≠ÿ© ÿßŸÑÿÆÿßÿ∑ŸÅÿ©\nÿ®ÿπÿØ ÿ≤ŸÖŸÜ ÿ∑ŸàŸäŸÑ ŸÖŸÜ ÿßŸÑÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑÿπÿ∏ŸäŸÖ.",
    "ÿ£ŸÜ Ÿáÿ∞ÿß ÿßŸÑŸàÿ¨ŸàÿØ ŸÇÿßÿ¶ŸÖ ‚Äì\nÿ≠ÿ≥ÿ® ŸÖÿß ŸÜÿπÿ±ŸÅ ‚Äì\nŸáŸà ÿ£ŸÖÿ± ŸÅÿ±ŸäÿØ.",
    "Ÿáÿ∞ÿß Ÿäÿ¨ÿπŸÑŸÜÿß ÿ¨ŸÖŸäÿπŸãÿß ŸÖŸÖŸäÿ≤ŸäŸÜ.\nŸàŸäÿ±ÿ®ÿ∑ŸÜÿß.",
    "ŸáŸÜÿß ŸäŸÖŸÉŸÜŸÉ ÿ£ŸÜ ÿ™ÿ∂ÿπ ŸÜŸàÿ±Ÿãÿß.\nŸàÿ™ÿ±Ÿâ\nÿ£ŸÜ ŸÉÿ´Ÿäÿ±ŸäŸÜ Ÿäÿ¥ÿπÿ±ŸàŸÜ ÿ®ÿßŸÑÿ¥Ÿäÿ° ŸÜŸÅÿ≥Ÿá."
  ],
  hi: [
    "‡§π‡§Æ ‡§≤‡§ó‡§≠‡§ó ‡§ï‡§≠‡•Ä ‡§á‡§∏‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§∏‡•ã‡§ö‡§§‡•á‡•§",
    "‡§Ö‡§™‡§®‡•á ‡§ú‡•Ä‡§µ‡§® ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç\n‡§á‡§∏ ‡§õ‡•ã‡§ü‡•á ‡§∏‡•á ‡§®‡•Ä‡§≤‡•á ‡§ó‡•ç‡§∞‡§π ‡§™‡§∞‡•§",
    "‡§á‡§∏ ‡§™‡§≤ ‡§≠‡§∞ ‡§Æ‡•á‡§Ç\n‡§Æ‡§π‡§æ‡§µ‡§ø‡§∏‡•ç‡§´‡•ã‡§ü ‡§ï‡•á ‡§¨‡§π‡•Å‡§§ ‡§¨‡§æ‡§¶‡•§",
    "‡§ï‡§ø ‡§á‡§∏‡§ï‡§æ ‡§Ö‡§∏‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§π‡•à ‚Äì\n‡§ú‡§ø‡§§‡§®‡§æ ‡§π‡§Æ ‡§ú‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç ‚Äì\n‡§µ‡§π ‡§Ö‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø ‡§π‡•à‡•§",
    "‡§Ø‡§π ‡§π‡§Æ ‡§∏‡§≠‡•Ä ‡§ï‡•ã ‡§ñ‡§æ‡§∏ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à‡•§\n‡§î‡§∞ ‡§π‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§§‡§æ ‡§π‡•à‡•§",
    "‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™ ‡§è‡§ï ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§∞‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§\n‡§î‡§∞ ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç\n‡§ï‡§ø ‡§¨‡§π‡•Å‡§§ ‡§∏‡•á ‡§≤‡•ã‡§ó ‡§µ‡§π‡•Ä ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§"
  ],
  bn: [
    "‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ï‡¶ñ‡¶®‡ßã‡¶á ‡¶è‡¶ü‡¶æ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶≠‡¶æ‡¶¨‡¶ø ‡¶®‡¶æ‡•§",
    "‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ú‡ßÄ‡¶¨‡¶®\n‡¶è‡¶á ‡¶õ‡ßã‡¶ü ‡¶®‡ßÄ‡¶≤ ‡¶ó‡ßç‡¶∞‡¶π‡ßá‡•§",
    "‡¶è‡¶á ‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶ö‡ßã‡¶ñ‡ßá‡¶∞ ‡¶™‡¶≤‡¶ï‡ßá\n‡¶¨‡¶ø‡¶ó ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶Ø‡¶º‡ßá‡¶∞ ‡¶¨‡¶π‡ßÅ ‡¶™‡¶∞‡ßá‡•§",
    "‡¶è‡¶∞ ‡¶Ö‡¶∏‡ßç‡¶§‡¶ø‡¶§‡ßç‡¶¨ ‚Äì\n‡¶Ø‡¶§‡¶ü‡ßÅ‡¶ï‡ßÅ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶ú‡¶æ‡¶®‡¶ø ‚Äì\n‡¶Ö‡¶®‡¶®‡ßç‡¶Ø‡•§",
    "‡¶è‡¶ü‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶¨‡¶æ‡¶á‡¶ï‡ßá ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡ßá ‡¶§‡ßã‡¶≤‡ßá‡•§\n‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßá‡•§",
    "‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ü‡¶≤‡ßã ‡¶¨‡¶∏‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßã‡•§\n‡¶è‡¶¨‡¶Ç ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßã\n‡¶Ø‡ßá ‡¶Ö‡¶®‡ßá‡¶ï‡ßá‡¶á ‡¶è‡¶ï‡¶á ‡¶Ö‡¶®‡ßÅ‡¶≠‡¶¨ ‡¶ï‡¶∞‡ßá‡•§"
  ],
  ur: [
    "€ÅŸÖ ÿ™ŸÇÿ±€åÿ®ÿßŸã ⁄©ÿ®⁄æ€å ÿßÿ≥ ⁄©€í ÿ®ÿßÿ±€í ŸÖ€å⁄∫ ŸÜ€Å€å⁄∫ ÿ≥Ÿà⁄Üÿ™€í€î",
    "ÿßŸæŸÜ€å ÿ≤ŸÜÿØ⁄Ø€å ⁄©€í ÿ®ÿßÿ±€í ŸÖ€å⁄∫\nÿßÿ≥ ⁄Ü⁄æŸàŸπ€í ÿ≥€í ŸÜ€åŸÑ€í ÿ≥€åÿßÿ±€í Ÿæÿ±€î",
    "ÿßÿ≥ ŸæŸÑ ÿ®⁄æÿ± ŸÖ€å⁄∫\nÿ®⁄Ø ÿ®€åŸÜ⁄Ø ⁄©€í ÿ®€Åÿ™ ÿ®ÿπÿØ€î",
    "⁄©€Å ÿßÿ≥ ⁄©ÿß Ÿàÿ¨ŸàÿØ €Å€í ‚Äì\nÿ¨ÿ™ŸÜÿß €ÅŸÖ ÿ¨ÿßŸÜÿ™€í €Å€å⁄∫ ‚Äì\nŸÖŸÜŸÅÿ±ÿØ €Å€í€î",
    "€å€Å €ÅŸÖ ÿ≥ÿ® ⁄©Ÿà ÿÆÿßÿµ ÿ®ŸÜÿßÿ™ÿß €Å€í€î\nÿßŸàÿ± €ÅŸÖ€å⁄∫ ÿ¨Ÿà⁄ëÿ™ÿß €Å€í€î",
    "€å€Åÿß⁄∫ ÿ¢Ÿæ ÿß€å⁄© ÿ±Ÿàÿ¥ŸÜ€å ÿ±⁄©⁄æ ÿ≥⁄©ÿ™€í €Å€å⁄∫€î\nÿßŸàÿ± ÿØ€å⁄©⁄æ ÿ≥⁄©ÿ™€í €Å€å⁄∫\n⁄©€Å ÿ®€Åÿ™ ÿ≥€í ŸÑŸà⁄Ø €å€Å€å ŸÖÿ≠ÿ≥Ÿàÿ≥ ⁄©ÿ±ÿ™€í €Å€å⁄∫€î"
  ],
  zh: [
    "Êàë‰ª¨Âá†‰πé‰ªé‰∏çÂéªÊÉ≥Ëøô‰∫õ„ÄÇ",
    "ÂÖ≥‰∫éÊàë‰ª¨ÁöÑÁîüÊ¥ª\nÂú®ËøôÈ¢óÂ∞èÂ∞èÁöÑËìùËâ≤ÊòüÁêÉ‰∏ä„ÄÇ",
    "Âú®ËøôÁü≠ÊöÇÁöÑ‰∏ÄÁû¨Èó¥Ôºå\nÂú®ÂÆáÂÆôÂ§ßÁàÜÁÇ∏‰πãÂêéÂæà‰πÖ„ÄÇ",
    "ÂÆÉÁöÑÂ≠òÂú®Êú¨Ë∫´ ‚Äì\nÂ∞±Êàë‰ª¨ÊâÄÁü• ‚Äì\nÊòØÁã¨‰∏ÄÊó†‰∫åÁöÑ„ÄÇ",
    "ËøôËÆ©Êàë‰ª¨ÊØè‰∏™‰∫∫ÈÉΩÂæàÁâπÂà´„ÄÇ\n‰πüÂ∞ÜÊàë‰ª¨ËøûÊé•Âú®‰∏ÄËµ∑„ÄÇ",
    "Âú®ËøôÈáåÔºå‰Ω†ÂèØ‰ª•ÁÇπ‰∫Æ‰∏ÄÁõèÁÅØ„ÄÇ\nÂπ∂ÁúãÂà∞\nÊúâËÆ∏Â§ö‰∫∫ÊúâÁùÄÂêåÊ†∑ÁöÑÊÑüÂèó„ÄÇ"
  ],
  ja: [
    "ÁßÅ„Åü„Å°„ÅØ„Åª„Å®„Çì„Å©ËÄÉ„Åà„Åæ„Åõ„Çì„ÄÇ",
    "„Åì„ÅÆÂ∞è„Åï„Å™Èùí„ÅÑÊÉëÊòü„Åß„ÅÆ\nÁßÅ„Åü„Å°„ÅÆÊöÆ„Çâ„Åó„Å´„Å§„ÅÑ„Å¶„ÄÇ",
    "„Éì„ÉÉ„Ç∞„Éê„É≥„Åã„Çâ„Åö„Å£„Å®Âæå„ÅÆ\n„Åì„ÅÆ‰∏ÄÁû¨„Å´„Å§„ÅÑ„Å¶„ÄÇ",
    "„Åù„Çå„ÅåÂ≠òÂú®„Åó„Å¶„ÅÑ„Çã„Åì„Å®Ëá™‰Ωì„Åå ‚Äì\nÁßÅ„Åü„Å°„ÅÆÁü•„ÇãÈôê„Çä ‚Äì\nÁâπÂà•„Åß„Åô„ÄÇ",
    "„Åù„Çå„ÅØÁßÅ„Åü„Å°ÁöÜ„ÇíÁâπÂà•„Å´„Åó„ÄÅ\nÁßÅ„Åü„Å°„Çí„Å§„Å™„Åé„Åæ„Åô„ÄÇ",
    "„Åì„Åì„ÅßÂÖâ„ÇíÁΩÆ„Åè„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n„Åù„Åó„Å¶\nÂ§ö„Åè„ÅÆ‰∫∫„ÅåÂêå„Åò„Çà„ÅÜ„Å´\nÊÑü„Åò„Å¶„ÅÑ„Çã„Åì„Å®„ÅåË¶ã„Åà„Åæ„Åô„ÄÇ"
  ],
  ko: [
    "Ïö∞Î¶¨Îäî Í±∞Ïùò ÏÉùÍ∞ÅÌïòÏßÄ ÏïäÏäµÎãàÎã§.",
    "Ïù¥ ÏûëÏùÄ Ìë∏Î•∏ ÌñâÏÑ±ÏóêÏÑúÏùò\nÏö∞Î¶¨Ïùò ÏÇ∂Ïóê ÎåÄÌï¥.",
    "ÎπÖÎ±Ö Ïù¥ÌõÑ ÌïúÏ∞∏Ïù¥ ÏßÄÎÇú\nÏù¥ ÏßßÏùÄ ÏàúÍ∞ÑÏóê ÎåÄÌï¥.",
    "Í∑∏ Ï°¥Ïû¨ ÏûêÏ≤¥Í∞Ä ‚Äì\nÏö∞Î¶¨Í∞Ä ÏïÑÎäî Ìïú ‚Äì\nÌäπÎ≥ÑÌï©ÎãàÎã§.",
    "Í∑∏Í≤ÉÏùÄ Ïö∞Î¶¨ Î™®ÎëêÎ•º ÌäπÎ≥ÑÌïòÍ≤å ÎßåÎì§Í≥†,\nÏö∞Î¶¨Î•º Ïó∞Í≤∞Ìï©ÎãàÎã§.",
    "Ïó¨Í∏∞ÏóêÏÑú ÎπõÏùÑ ÎÜìÏùÑ Ïàò ÏûàÏäµÎãàÎã§.\nÍ∑∏Î¶¨Í≥†\nÎßéÏùÄ Ïù¥Îì§Ïù¥ Í∞ôÏùÄ Í∞êÏ†ïÏùÑ\nÎäêÎÅºÍ≥† ÏûàÏùåÏùÑ Î≥º Ïàò ÏûàÏäµÎãàÎã§."
  ],
  vi: [
    "Ch√∫ng ta h·∫ßu nh∆∞ kh√¥ng bao gi·ªù nghƒ© ƒë·∫øn ƒëi·ªÅu ƒë√≥.",
    "V·ªÅ cu·ªôc s·ªëng c·ªßa m√¨nh\ntr√™n h√†nh tinh xanh nh·ªè b√© n√†y.",
    "Trong kho·∫£nh kh·∫Øc ch·ªõp m·∫Øt n√†y\nr·∫•t l√¢u sau V·ª• N·ªï L·ªõn.",
    "Vi·ªác n√≥ t·ªìn t·∫°i ‚Äì\nnh∆∞ nh·ªØng g√¨ ch√∫ng ta bi·∫øt ‚Äì\nl√† ƒëi·ªÅu ƒë·ªôc nh·∫•t.",
    "ƒêi·ªÅu ƒë√≥ khi·∫øn t·∫•t c·∫£ ch√∫ng ta tr·ªü n√™n ƒë·∫∑c bi·ªát.\nV√† k·∫øt n·ªëi ch√∫ng ta.",
    "T·∫°i ƒë√¢y, b·∫°n c√≥ th·ªÉ ƒë·∫∑t m·ªôt √°nh s√°ng.\nV√† th·∫•y\nr·∫±ng nhi·ªÅu ng∆∞·ªùi c·∫£m nh·∫≠n ƒëi·ªÅu t∆∞∆°ng t·ª±."
  ],
  tr: [
    "Bunu neredeyse hi√ß d√º≈ü√ºnmeyiz.",
    "Bu k√º√ß√ºk mavi gezegendeki\nhayatƒ±mƒ±zƒ±.",
    "B√ºy√ºk Patlama‚Äôdan √ßok sonra\nbu g√∂z a√ßƒ±p kapama anƒ±nda.",
    "Onun var olmasƒ± ‚Äì\nbildiƒüimiz kadarƒ±yla ‚Äì\ntekdir.",
    "Bu hepimizi √∂zel kƒ±lar.\nVe birbirimize baƒülar.",
    "Burada bir ƒ±≈üƒ±k bƒ±rakabilirsin.\nVe g√∂rebilirsin\nki bir√ßok ki≈üi aynƒ± ≈üeyi hissediyor."
  ],
  sw: [
    "Karibu hatufikirii kuhusu hilo.",
    "Kuhusu maisha yetu\nkwenye sayari hii ndogo ya buluu.",
    "Katika mng‚Äôao huu mfupi\nmuda mrefu baada ya Mlipo Mkuu.",
    "Kwamba yapo ‚Äì\nkadiri tunavyojua ‚Äì\nni ya kipekee.",
    "Hilo hutufanya sote tuwe wa pekee.\nNa hutunganisha.",
    "Hapa unaweza kuweka mwanga.\nNa kuona\nkwamba wengi wanahisi vivyo hivyo."
  ],
  id: [
    "Kita hampir tidak pernah memikirkannya.",
    "Tentang kehidupan kita\ndi planet biru kecil ini.",
    "Dalam kedipan singkat ini\nlama setelah Dentuman Besar.",
    "Bahwa itu ada ‚Äì\nsejauh yang kita ketahui ‚Äì\nadalah sesuatu yang unik.",
    "Hal itu membuat kita semua istimewa.\nDan menghubungkan kita.",
    "Di sini kamu bisa menempatkan sebuah cahaya.\nDan melihat\nbahwa banyak yang merasakan hal yang sama."
  ]
};

const UI = {
  en: {
    world: "World view",
    card: "Generate map",
    hint: "Click on the map to place or move your light. (One light per browser.)",
    status_set: "Your light is set. You can move it by clicking on the map.",
    status_empty: "Place your light by clicking on the map.",
    status_error_load: "Could not load lights. Check Supabase URL/Key and table/policies.",
    status_error_save: "Saving failed. Check Supabase policies (RLS).",
    status_export: "Creating image‚Ä¶",
    status_done: "Done.",
    copy_ok: "Link copied",
    share_title: "Together We Are One"
  },
  de: {
    world: "Weltansicht",
    card: "Karte generieren",
    hint: "Klicke auf die Karte, um dein Licht zu setzen oder zu verschieben. (Nur ein Licht pro Browser.)",
    status_set: "Dein Licht ist gesetzt. Du kannst es durch Klicken verschieben.",
    status_empty: "Setze dein Licht mit einem Klick auf die Karte.",
    status_error_load: "Konnte Lichter nicht laden. Pr√ºfe Supabase URL/Key und Tabelle/Policies.",
    status_error_save: "Speichern fehlgeschlagen. Pr√ºfe Supabase-Policies (RLS).",
    status_export: "Erzeuge Bild‚Ä¶",
    status_done: "Fertig.",
    copy_ok: "Link kopiert",
    share_title: "Together We Are One"
  },
  es:{ world:"Vista mundial", card:"Generar mapa", hint:"Haz clic en el mapa para colocar o mover tu luz. (Una luz por navegador.)", status_set:"Tu luz est√° colocada. Puedes moverla haciendo clic.", status_empty:"Coloca tu luz haciendo clic en el mapa.", status_error_load:"No se pudieron cargar las luces.", status_error_save:"Error al guardar.", status_export:"Creando imagen‚Ä¶", status_done:"Listo.", copy_ok:"Enlace copiado", share_title:"Together We Are One" },
  fr:{ world:"Vue du monde", card:"G√©n√©rer la carte", hint:"Cliquez sur la carte pour placer ou d√©placer votre lumi√®re. (Une lumi√®re par navigateur.)", status_set:"Votre lumi√®re est plac√©e. Vous pouvez la d√©placer.", status_empty:"Placez votre lumi√®re en cliquant sur la carte.", status_error_load:"Impossible de charger les lumi√®res.", status_error_save:"√âchec de l‚Äôenregistrement.", status_export:"Cr√©ation de l‚Äôimage‚Ä¶", status_done:"Termin√©.", copy_ok:"Lien copi√©", share_title:"Together We Are One" },
  pt:{ world:"Vis√£o mundial", card:"Gerar mapa", hint:"Clique no mapa para colocar ou mover sua luz. (Uma luz por navegador.)", status_set:"Sua luz foi colocada. Voc√™ pode mov√™-la.", status_empty:"Coloque sua luz clicando no mapa.", status_error_load:"N√£o foi poss√≠vel carregar as luzes.", status_error_save:"Falha ao salvar.", status_export:"Gerando imagem‚Ä¶", status_done:"Conclu√≠do.", copy_ok:"Link copiado", share_title:"Together We Are One" },
  ru:{ world:"–í–∏–¥ –º–∏—Ä–∞", card:"–°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—É", hint:"–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Å–≤–µ—Ç. (–û–¥–∏–Ω —Å–≤–µ—Ç –Ω–∞ –±—Ä–∞—É–∑–µ—Ä.)", status_set:"–í–∞—à —Å–≤–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –í—ã –º–æ–∂–µ—Ç–µ –µ–≥–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å.", status_empty:"–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–µ—Ç.", status_error_load:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–≥–Ω–∏.", status_error_save:"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.", status_export:"–°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è‚Ä¶", status_done:"–ì–æ—Ç–æ–≤–æ.", copy_ok:"–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞", share_title:"Together We Are One" },
  ar:{ world:"ÿπÿ±ÿ∂ ÿßŸÑÿπÿßŸÑŸÖ", card:"ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ©", hint:"ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ŸÑŸàÿ∂ÿπ ÿßŸÑÿ∂Ÿàÿ° ÿ£Ÿà ÿ™ÿ≠ÿ±ŸäŸÉŸá. (ÿ∂Ÿàÿ° Ÿàÿßÿ≠ÿØ ŸÑŸÉŸÑ ŸÖÿ™ÿµŸÅÿ≠.)", status_set:"ÿ™ŸÖ Ÿàÿ∂ÿπ ÿ∂Ÿàÿ¶ŸÉ. ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ≠ÿ±ŸäŸÉŸá.", status_empty:"ÿ∂ÿπ ÿ∂Ÿàÿ°ŸÉ ÿ®ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ©.", status_error_load:"ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ∂Ÿàÿßÿ°.", status_error_save:"ŸÅÿ¥ŸÑ ÿßŸÑÿ≠ŸÅÿ∏.", status_export:"ÿ¨ÿßÿ±Ÿç ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿµŸàÿ±ÿ©‚Ä¶", status_done:"ÿ™ŸÖ.", copy_ok:"ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑", share_title:"Together We Are One" },
  hi:{ world:"‡§µ‡§ø‡§∂‡•ç‡§µ ‡§¶‡•É‡§∂‡•ç‡§Ø", card:"‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞ ‡§¨‡§®‡§æ‡§è‡§Å", hint:"‡§Ö‡§™‡§®‡•Ä ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§≤‡§ó‡§æ‡§®‡•á ‡§Ø‡§æ ‡§∏‡•ç‡§•‡§æ‡§® ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§ (‡§™‡•ç‡§∞‡§§‡§ø ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§è‡§ï ‡§∞‡•ã‡§∂‡§®‡•Ä.)", status_set:"‡§Ü‡§™‡§ï‡•Ä ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§∏‡•á‡§ü ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§", status_empty:"‡§Æ‡§æ‡§®‡§ö‡§ø‡§§‡•ç‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§™‡§®‡•Ä ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§≤‡§ó‡§æ‡§è‡§Å‡•§", status_error_load:"‡§∞‡•ã‡§∂‡§®‡§ø‡§Ø‡§æ‡§Å ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡•Ä‡§Ç‡•§", status_error_save:"‡§∏‡§π‡•á‡§ú‡§®‡§æ ‡§µ‡§ø‡§´‡§≤ ‡§∞‡§π‡§æ‡•§", status_export:"‡§ö‡§ø‡§§‡•ç‡§∞ ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶", status_done:"‡§™‡•Ç‡§∞‡•ç‡§£‡•§", copy_ok:"‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•â‡§™‡•Ä ‡§π‡•Å‡§Ü", share_title:"Together We Are One" },
  bn:{ world:"‡¶¨‡¶ø‡¶∂‡ßç‡¶¨ ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø", card:"‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®", hint:"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶≤‡ßã ‡¶¨‡¶∏‡¶æ‡¶§‡ßá ‡¶¨‡¶æ ‡¶∏‡¶∞‡¶æ‡¶§‡ßá ‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ü‡¶≤‡ßã.)", status_set:"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶≤‡ßã ‡¶¨‡¶∏‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ü‡¶ø ‡¶∏‡¶∞‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§", status_empty:"‡¶Æ‡¶æ‡¶®‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶≤‡ßã ‡¶¨‡¶∏‡¶æ‡¶®‡•§", status_error_load:"‡¶Ü‡¶≤‡ßã ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§", status_error_save:"‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", status_export:"‡¶õ‡¶¨‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶", status_done:"‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®‡•§", copy_ok:"‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá", share_title:"Together We Are One" },
  ur:{ world:"ÿπÿßŸÑŸÖ€å ŸÖŸÜÿ∏ÿ±", card:"ŸÜŸÇÿ¥€Å ÿ®ŸÜÿßÿ¶€å⁄∫", hint:"ÿßŸæŸÜ€å ÿ±Ÿàÿ¥ŸÜ€å ÿ±⁄©⁄æŸÜ€í €åÿß ŸÖŸÜÿ™ŸÇŸÑ ⁄©ÿ±ŸÜ€í ⁄©€í ŸÑ€å€í ŸÜŸÇÿ¥€í Ÿæÿ± ⁄©ŸÑ⁄© ⁄©ÿ±€å⁄∫€î (€Åÿ± ÿ®ÿ±ÿßÿ§ÿ≤ÿ± ⁄©€í ŸÑ€å€í ÿß€å⁄© ÿ±Ÿàÿ¥ŸÜ€å.)", status_set:"ÿ¢Ÿæ ⁄©€å ÿ±Ÿàÿ¥ŸÜ€å ÿ≥€åŸπ €ÅŸà ⁄Øÿ¶€å €Å€í€î", status_empty:"ŸÜŸÇÿ¥€í Ÿæÿ± ⁄©ŸÑ⁄© ⁄©ÿ± ⁄©€í ÿßŸæŸÜ€å ÿ±Ÿàÿ¥ŸÜ€å ÿ±⁄©⁄æ€å⁄∫€î", status_error_load:"ÿ±Ÿàÿ¥ŸÜ€å ŸÑŸà⁄à ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©€å€î", status_error_save:"ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±ŸÜÿß ŸÜÿß⁄©ÿßŸÖ ÿ±€Åÿß€î", status_export:"ÿ™ÿµŸà€åÿ± ÿ®ŸÜÿßÿ¶€å ÿ¨ÿß ÿ±€Å€å €Å€í‚Ä¶", status_done:"ŸÖ⁄©ŸÖŸÑ€î", copy_ok:"ŸÑŸÜ⁄© ⁄©ÿßŸæ€å €ÅŸà ⁄Ø€åÿß", share_title:"Together We Are One" },
  zh:{ world:"‰∏ñÁïåËßÜÂõæ", card:"ÁîüÊàêÂú∞Âõæ", hint:"ÁÇπÂáªÂú∞Âõæ‰ª•ÊîæÁΩÆÊàñÁßªÂä®‰Ω†ÁöÑÂÖâÁÇπ„ÄÇÔºàÊØè‰∏™ÊµèËßàÂô®‰∏Ä‰∏™ÂÖâÁÇπ„ÄÇÔºâ", status_set:"‰Ω†ÁöÑÂÖâÁÇπÂ∑≤ËÆæÁΩÆÔºåÂèØ‰ª•ÁßªÂä®„ÄÇ", status_empty:"ÁÇπÂáªÂú∞ÂõæÊîæÁΩÆ‰Ω†ÁöÑÂÖâÁÇπ„ÄÇ", status_error_load:"Êó†Ê≥ïÂä†ËΩΩÂÖâÁÇπ„ÄÇ", status_error_save:"‰øùÂ≠òÂ§±Ë¥•„ÄÇ", status_export:"Ê≠£Âú®ÁîüÊàêÂõæÁâá‚Ä¶", status_done:"ÂÆåÊàê„ÄÇ", copy_ok:"ÈìæÊé•Â∑≤Â§çÂà∂", share_title:"Together We Are One" },
  ja:{ world:"‰∏ñÁïåË°®Á§∫", card:"Âú∞Âõ≥„ÇíÁîüÊàê", hint:"Âú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂÖâ„ÇíÁΩÆ„ÅÑ„Åü„ÇäÂãï„Åã„Åó„Åü„Çä„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÔºà„Éñ„É©„Ç¶„Ç∂„Åî„Å®„Å´1„Å§Ôºâ", status_set:"ÂÖâ„ÅåË®≠ÂÆö„Åï„Çå„Åæ„Åó„Åü„ÄÇÁßªÂãï„Åß„Åç„Åæ„Åô„ÄÇ", status_empty:"Âú∞Âõ≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂÖâ„ÇíÁΩÆ„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", status_error_load:"ÂÖâ„ÇíË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ", status_error_save:"‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ", status_export:"ÁîªÂÉè„Çí‰ΩúÊàê‰∏≠‚Ä¶", status_done:"ÂÆå‰∫Ü„ÄÇ", copy_ok:"„É™„É≥„ÇØ„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü", share_title:"Together We Are One" },
  ko:{ world:"ÏÑ∏Í≥Ñ Î≥¥Í∏∞", card:"ÏßÄÎèÑ ÏÉùÏÑ±", hint:"ÏßÄÎèÑÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÎπõÏùÑ ÎÜìÍ±∞ÎÇò Ïù¥ÎèôÌïòÏÑ∏Ïöî. (Î∏åÎùºÏö∞Ï†ÄÎãπ 1Í∞ú)", status_set:"ÎπõÏù¥ ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§. Ïù¥ÎèôÌï† Ïàò ÏûàÏäµÎãàÎã§.", status_empty:"ÏßÄÎèÑÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ ÎπõÏùÑ ÎÜìÏúºÏÑ∏Ïöî.", status_error_load:"ÎπõÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.", status_error_save:"Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.", status_export:"Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë‚Ä¶", status_done:"ÏôÑÎ£å.", copy_ok:"ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§", share_title:"Together We Are One" },
  vi:{ world:"Ch·∫ø ƒë·ªô xem th·∫ø gi·ªõi", card:"T·∫°o b·∫£n ƒë·ªì", hint:"Nh·∫•p v√†o b·∫£n ƒë·ªì ƒë·ªÉ ƒë·∫∑t ho·∫∑c di chuy·ªÉn √°nh s√°ng. (M·ªôt √°nh s√°ng m·ªói tr√¨nh duy·ªát.)", status_set:"√Ånh s√°ng c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t.", status_empty:"Nh·∫•p v√†o b·∫£n ƒë·ªì ƒë·ªÉ ƒë·∫∑t √°nh s√°ng.", status_error_load:"Kh√¥ng th·ªÉ t·∫£i √°nh s√°ng.", status_error_save:"L∆∞u th·∫•t b·∫°i.", status_export:"ƒêang t·∫°o h√¨nh ·∫£nh‚Ä¶", status_done:"Ho√†n t·∫•t.", copy_ok:"ƒê√£ sao ch√©p li√™n k·∫øt", share_title:"Together We Are One" },
  tr:{ world:"D√ºnya g√∂r√ºn√ºm√º", card:"Harita olu≈ütur", hint:"I≈üƒ±ƒüƒ±nƒ±zƒ± yerle≈ütirmek veya ta≈üƒ±mak i√ßin haritaya tƒ±klayƒ±n. (Tarayƒ±cƒ± ba≈üƒ±na bir ƒ±≈üƒ±k.)", status_set:"I≈üƒ±ƒüƒ±nƒ±z yerle≈ütirildi.", status_empty:"Haritaya tƒ±klayarak ƒ±≈üƒ±ƒüƒ±nƒ±zƒ± yerle≈ütirin.", status_error_load:"I≈üƒ±klar y√ºklenemedi.", status_error_save:"Kaydetme ba≈üarƒ±sƒ±z.", status_export:"G√∂rsel olu≈üturuluyor‚Ä¶", status_done:"Tamamlandƒ±.", copy_ok:"Baƒülantƒ± kopyalandƒ±", share_title:"Together We Are One" },
  sw:{ world:"Mtazamo wa dunia", card:"Tengeneza ramani", hint:"Bofya ramani ili kuweka au kusogeza mwanga wako. (Mwanga mmoja kwa kivinjari.)", status_set:"Mwanga wako umewekwa.", status_empty:"Bofya ramani kuweka mwanga wako.", status_error_load:"Imeshindikana kupakia taa.", status_error_save:"Kuhifadhi kumeshindikana.", status_export:"Inaunda picha‚Ä¶", status_done:"Imekamilika.", copy_ok:"Kiungo kimenakiliwa", share_title:"Together We Are One" },
  id:{ world:"Tampilan dunia", card:"Buat peta", hint:"Klik peta untuk menempatkan atau memindahkan cahaya Anda. (Satu cahaya per browser.)", status_set:"Cahaya Anda telah ditempatkan.", status_empty:"Klik peta untuk menempatkan cahaya Anda.", status_error_load:"Tidak dapat memuat cahaya.", status_error_save:"Gagal menyimpan.", status_export:"Membuat gambar‚Ä¶", status_done:"Selesai.", copy_ok:"Tautan disalin", share_title:"Together We Are One" }
};

const PRIVACY_HINT = {
  de: "Lichter sind anonym und auf etwa 10 km gerundet.",
  en: "Lights are anonymous and rounded to about 10 km.",
  fr: "Les lumi√®res sont anonymes et arrondies √† environ 10 km.",
  es: "Las luces son an√≥nimas y est√°n redondeadas a unos 10 km.",
  pt: "As luzes s√£o an√¥nimas e arredondadas para cerca de 10 km.",
  ru: "–û–≥–Ω–∏ –∞–Ω–æ–Ω–∏–º–Ω—ã –∏ –æ–∫—Ä—É–≥–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä–Ω–æ –¥–æ 10 –∫–º.",
  ar: "ÿßŸÑÿ£ÿ∂Ÿàÿßÿ° ŸÖÿ¨ŸáŸàŸÑÿ© ÿßŸÑŸáŸàŸäÿ© ŸàŸÖŸÇÿ±ÿ®ÿ© ÿ•ŸÑŸâ ÿ≠ŸàÿßŸÑŸä 10 ŸÉŸÖ.",
  hi: "‡§≤‡§æ‡§á‡§ü‡•ç‡§∏ ‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§≤‡§ó‡§≠‡§ó 10 ‡§ï‡§ø‡§Æ‡•Ä ‡§§‡§ï ‡§ó‡•ã‡§≤ ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡§Ç‡•§",
  bn: "‡¶Ü‡¶≤‡ßã ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ó‡ßã‡¶™‡¶®‡ßÄ‡¶Ø‡¶º ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡ßß‡ß¶ ‡¶ï‡¶ø‡¶Æ‡¶ø ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
  ur: "ŸÑÿßÿ¶Ÿπÿ≥ ⁄ØŸÖŸÜÿßŸÖ €Å€å⁄∫ ÿßŸàÿ± ÿ™ŸÇÿ±€åÿ®ÿßŸã 10 ⁄©ŸÑŸàŸÖ€åŸπÿ± ÿ™⁄© ⁄ØŸàŸÑ ⁄©€å ⁄Øÿ¶€å €Å€å⁄∫€î",
  zh: "ÁÅØÂÖâÊòØÂåøÂêçÁöÑÔºåÂπ∂ÂõõËàç‰∫îÂÖ•Âà∞Á∫¶10ÂÖ¨Èáå„ÄÇ",
  ja: "„É©„Ç§„Éà„ÅØÂåøÂêç„Åß„ÄÅÁ¥Ñ10kmÂçò‰Ωç„Å´‰∏∏„ÇÅ„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
  ko: "ÎπõÏùÄ ÏùµÎ™ÖÏù¥Î©∞ ÏïΩ 10km Îã®ÏúÑÎ°ú Î∞òÏò¨Î¶ºÎê©ÎãàÎã§.",
  vi: "C√°c √°nh s√°ng l√† ·∫©n danh v√† ƒë∆∞·ª£c l√†m tr√≤n kho·∫£ng 10 km.",
  tr: "I≈üƒ±klar anonimdir ve yakla≈üƒ±k 10 km‚Äôye yuvarlanƒ±r.",
  sw: "Taa ni za siri na zimezungushwa hadi takriban km 10.",
  id: "Cahaya bersifat anonim dan dibulatkan hingga sekitar 10 km."
};

const SHARE_MAIN_LABEL = {
  de: "Mit einer Freundin oder einem Freund teilen",
  en: "Share with a friend",
  fr: "Partager avec un ami",
  es: "Compartir con un amigo",
  pt: "Compartilhar com um amigo",
  ru: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–≥–æ–º",
  ar: "ÿ¥ÿßÿ±ŸÉ ŸÖÿπ ÿµÿØŸäŸÇ",
  hi: "‡§ï‡§ø‡§∏‡•Ä ‡§¶‡•ã‡§∏‡•ç‡§§ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç",
  bn: "‡¶è‡¶ï‡¶ú‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®",
  ur: "⁄©ÿ≥€å ÿØŸàÿ≥ÿ™ ⁄©€í ÿ≥ÿßÿ™⁄æ ÿ¥€åÿ¶ÿ± ⁄©ÿ±€å⁄∫",
  zh: "ÂàÜ‰∫´ÁªôÊúãÂèã",
  ja: "Âèã„Å†„Å°„Å®ÂÖ±Êúâ„Åô„Çã",
  ko: "ÏπúÍµ¨ÏôÄ Í≥µÏú†ÌïòÍ∏∞",
  vi: "Chia s·∫ª v·ªõi m·ªôt ng∆∞·ªùi b·∫°n",
  tr: "Bir arkada≈üƒ±nla payla≈ü",
  sw: "Shiriki na rafiki",
  id: "Bagikan dengan seorang teman"
};

const SHARE_TEXT = {
  de: "Eine stille Seite. Man setzt ein Licht und sieht, dass viele dasselbe f√ºhlen.",
  en: "A quiet place. You set a light and see that many feel the same.",
  es: "Un lugar tranquilo. Pones una luz y ves que muchos sienten lo mismo.",
  fr: "Un endroit calme. On y place une lumi√®re et on voit que beaucoup ressentent la m√™me chose.",
  pt: "Um lugar tranquilo. Voc√™ coloca uma luz e v√™ que muitos sentem o mesmo.",
  ru: "–¢–∏—Ö–æ–µ –º–µ—Å—Ç–æ. –¢—ã –∑–∞–∂–∏–≥–∞–µ—à—å —Å–≤–µ—Ç –∏ –≤–∏–¥–∏—à—å, —á—Ç–æ –º–Ω–æ–≥–∏–µ —á—É–≤—Å—Ç–≤—É—é—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ.",
  ar: "ŸÖŸÉÿßŸÜ ŸáÿßÿØÿ¶. ÿ™ÿ∂ÿπ ŸÜŸàÿ±Ÿãÿß Ÿàÿ™ÿ±Ÿâ ÿ£ŸÜ ŸÉÿ´Ÿäÿ±ŸäŸÜ Ÿäÿ¥ÿπÿ±ŸàŸÜ ÿ®ÿßŸÑÿ¥Ÿäÿ° ŸÜŸÅÿ≥Ÿá.",
  hi: "‡§è‡§ï ‡§∂‡§æ‡§Ç‡§§ ‡§ú‡§ó‡§π‡•§ ‡§Ü‡§™ ‡§è‡§ï ‡§∞‡•ã‡§∂‡§®‡•Ä ‡§∞‡§ñ‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§¶‡•á‡§ñ‡§§‡•á ‡§π‡•à‡§Ç ‡§ï‡§ø ‡§¨‡§π‡•Å‡§§ ‡§∏‡•á ‡§≤‡•ã‡§ó ‡§µ‡§π‡•Ä ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§",
  bn: "‡¶è‡¶ï‡¶ü‡¶ø ‡¶∂‡¶æ‡¶®‡ßç‡¶§ ‡¶ú‡¶æ‡¶Ø‡¶º‡¶ó‡¶æ‡•§ ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ü‡¶≤‡ßã ‡¶¨‡¶∏‡¶æ‡¶ì ‡¶è‡¶¨‡¶Ç ‡¶¶‡ßá‡¶ñ‡ßã ‡¶Ø‡ßá ‡¶Ö‡¶®‡ßá‡¶ï‡ßá‡¶á ‡¶è‡¶ï‡¶á ‡¶Ö‡¶®‡ßÅ‡¶≠‡¶¨ ‡¶ï‡¶∞‡ßá‡•§",
  ur: "ÿß€å⁄© ÿÆÿßŸÖŸàÿ¥ ÿ¨⁄Ø€Å€î ÿ¢Ÿæ ÿß€å⁄© ÿ±Ÿàÿ¥ŸÜ€å ÿ±⁄©⁄æÿ™€í €Å€å⁄∫ ÿßŸàÿ± ÿØ€å⁄©⁄æÿ™€í €Å€å⁄∫ ⁄©€Å ÿ®€Åÿ™ ÿ≥€í ŸÑŸà⁄Ø Ÿà€Å€å ŸÖÿ≠ÿ≥Ÿàÿ≥ ⁄©ÿ±ÿ™€í €Å€å⁄∫€î",
  zh: "‰∏Ä‰∏™ÂÆâÈùôÁöÑÂú∞Êñπ„ÄÇ‰Ω†ÁÇπ‰∫Æ‰∏ÄÁõèÁÅØÔºåÁúãÂà∞ËÆ∏Â§ö‰∫∫ÊúâÁùÄÁõ∏ÂêåÁöÑÊÑüÂèó„ÄÇ",
  ja: "Èùô„Åã„Å™Â†¥ÊâÄ„ÄÇÂÖâ„ÇíÁΩÆ„Åè„Å®„ÄÅÂêå„Åò„Çà„ÅÜ„Å´ÊÑü„Åò„Å¶„ÅÑ„Çã‰∫∫„Åå„Åü„Åè„Åï„Çì„ÅÑ„Çã„Åì„Å®„Åå„Çè„Åã„Çä„Åæ„Åô„ÄÇ",
  ko: "Ï°∞Ïö©Ìïú Í≥µÍ∞Ñ. ÎπõÏùÑ ÎÜìÏúºÎ©¥ ÎßéÏùÄ ÏÇ¨ÎûåÎì§Ïù¥ Í∞ôÏùÄ Í∞êÏ†ïÏùÑ ÎäêÎÅºÍ≥† ÏûàÏùåÏùÑ Î≥º Ïàò ÏûàÏäµÎãàÎã§.",
  vi: "M·ªôt n∆°i y√™n tƒ©nh. B·∫°n ƒë·∫∑t m·ªôt √°nh s√°ng v√† th·∫•y r·∫±ng nhi·ªÅu ng∆∞·ªùi c≈©ng c·∫£m nh·∫≠n nh∆∞ v·∫≠y.",
  tr: "Sessiz bir yer. Bir ƒ±≈üƒ±k bƒ±rakƒ±rsƒ±n ve bir√ßok ki≈üinin aynƒ± ≈üeyi hissettiƒüini g√∂r√ºrs√ºn.",
  sw: "Mahali tulivu. Unaweka mwanga na kuona kwamba wengi wanahisi vivyo hivyo.",
  id: "Tempat yang tenang. Kamu menempatkan sebuah cahaya dan melihat bahwa banyak yang merasakan hal yang sama."
};

const UI_TEXT = UI[LANG] || UI.en;
const tpTexts = TP[LANG] || TP.en;

document.getElementById("btnWorld").textContent = UI_TEXT.world;
document.getElementById("btnCard").textContent  = UI_TEXT.card;
document.getElementById("hint").textContent     = UI_TEXT.hint;
document.getElementById("privacyHint").textContent = PRIVACY_HINT[LANG] || PRIVACY_HINT.en;
document.getElementById("shareMain").textContent = SHARE_MAIN_LABEL[LANG] || SHARE_MAIN_LABEL.en;

/* -------------------------
   3) Teleprompter (word-by-word + line breaks)
-------------------------- */
const CHAR_BASED_LANGS = ["zh","ja","ko"];
const WORD_MS = (CHAR_BASED_LANGS.includes(LANG) ? 190 : 240);
const SENTENCE_PAUSE = 900;

let tpIndex = 0, tpUnitIdx = 0, tpTimer = null;
const tpTextEl = document.getElementById("tp-text");
const tpBarEl  = document.getElementById("tp-bar");

function renderSentence(sentence){
  const s = sentence.replace(/\n/g, " \n ");
  const tokens = s.split(/(\s+)/);
  tpTextEl.innerHTML = tokens.map(t => {
    if (t === "\n") return `<span class="tp-br"></span>`;
    if (/^\s+$/.test(t)) return `<span class="tp-space">${t}</span>`;
    return `<span class="tp-word">${t}</span>`;
  }).join("");
}

function getUnits(sentence){
  if (CHAR_BASED_LANGS.includes(LANG)) return Array.from(sentence.replace(/\s+/g, ""));
  return sentence.replace(/\n/g, " ").split(/\s+/).filter(Boolean);
}

function markProgress(activeIdx){
  const wordSpans = Array.from(tpTextEl.querySelectorAll(".tp-word"));
  wordSpans.forEach((w, i) => {
    w.classList.remove("active");
    if (i <= activeIdx) w.classList.add("done"); else w.classList.remove("done");
  });
  if (wordSpans[activeIdx]) wordSpans[activeIdx].classList.add("active");
}

function updateProgress(){
  tpBarEl.style.width = `${100 * (tpIndex + 1) / tpTexts.length}%`;
}

function playSentence(idx, auto=true){
  clearInterval(tpTimer);
  tpIndex = idx;
  tpUnitIdx = 0;

  renderSentence(tpTexts[tpIndex]);
  updateProgress();

  const units = getUnits(tpTexts[tpIndex]);
  markProgress(0);

  tpTimer = setInterval(() => {
    tpUnitIdx++;
    if (tpUnitIdx < units.length) markProgress(tpUnitIdx);
    else {
      clearInterval(tpTimer);
      markProgress(Math.max(0, units.length - 1));
      if (auto) {
        setTimeout(() => {
          if (tpIndex < tpTexts.length - 1) playSentence(tpIndex + 1, true);
        }, SENTENCE_PAUSE);
      }
    }
  }, WORD_MS);
}

document.getElementById("tp-prev").addEventListener("click", () => { if (tpIndex > 0) playSentence(tpIndex - 1, false); });
document.getElementById("tp-next").addEventListener("click", () => { if (tpIndex < tpTexts.length - 1) playSentence(tpIndex + 1, false); });
playSentence(0, true);

/* -------------------------
   4) Share (native share sheet + fallback copy)
-------------------------- */
function shareUrlForLang() {
  return `${location.origin}/?lang=${encodeURIComponent(LANG)}`;
}

document.getElementById("shareMain").addEventListener("click", async () => {
  const url = shareUrlForLang();
  const text = SHARE_TEXT[LANG] || SHARE_TEXT.en;

  if (navigator.share) {
    try {
      await navigator.share({
        title: UI_TEXT.share_title || "Together We Are One",
        text,
        url
      });
    } catch (_) {}
    return;
  }

  try {
    await navigator.clipboard.writeText(url);
    alert(UI_TEXT.copy_ok || "Link copied");
  } catch (_) {
    prompt("", url);
  }
});

/* -------------------------
   5) Supabase
-------------------------- */
function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

const SUPABASE_URL = 'https://gwfqdukbcgtcefqtgnbl.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3ZnFkdWtiY2d0Y2VmcXRnbmJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MDU2MTMsImV4cCI6MjA4NDI4MTYxM30.ePyuDxhVoc1ol5lQ8JbRKaybgpEPozBR3Wf71oFj040';

const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let session = localStorage.getItem('myLightSession');
if(!session) { session = uuidv4(); localStorage.setItem('myLightSession', session); }

const statusEl = document.getElementById("status");
function setStatus(key){
  statusEl.textContent = UI_TEXT[key] || "";
}

/* -------------------------
   6) Map
-------------------------- */
const WORLD_BOUNDS = L.latLngBounds(L.latLng(-60, -180), L.latLng(85, 180));
const WORLD_VIEW = { center: [20, 0], zoom: 2.0 };

const map = L.map('map', {
  zoomControl: true,
  preferCanvas: true,
  worldCopyJump: false,
  zoomSnap: 0.25,
  zoomDelta: 0.25,
  maxBounds: WORLD_BOUNDS,
  maxBoundsViscosity: 1.0
}).setView(WORLD_VIEW.center, WORLD_VIEW.zoom);

const tileUrlLabels   = 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png';
const tileUrlNoLabels = 'https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png';

const baseWithLabels = L.tileLayer(tileUrlLabels, {
  attribution: '&copy; OpenStreetMap &copy; CARTO',
  maxZoom: 18,
  noWrap: true,
  bounds: WORLD_BOUNDS,
  crossOrigin: true
}).addTo(map);

const baseNoLabels = L.tileLayer(tileUrlNoLabels, {
  attribution: '&copy; OpenStreetMap &copy; CARTO',
  maxZoom: 18,
  noWrap: true,
  bounds: WORLD_BOUNDS,
  crossOrigin: true
});

const canvasRenderer = L.canvas({ padding: 0.5 });
const lightsLayer = L.layerGroup().addTo(map);

function anonymize(lat, lng) {
  const GRID = 0.1; // ~10-11km
  return {
    lat: Math.round(lat / GRID) * GRID,
    lng: Math.round(lng / GRID) * GRID
  };
}

// Ghost light (cursor)
const ghost = L.circleMarker([0,0], {
  renderer: canvasRenderer,
  radius: 10,
  stroke: false,
  fill: true,
  fillOpacity: 0.10,
  fillColor: "rgba(255,220,170,1)",
  interactive: false
}).addTo(map);

const ghostCore = L.circleMarker([0,0], {
  renderer: canvasRenderer,
  radius: 2.2,
  stroke: false,
  fill: true,
  fillOpacity: 0.75,
  fillColor: "rgba(255,255,255,1)",
  interactive: false
}).addTo(map);

map.on("mouseover", () => {
  ghost.setStyle({ fillOpacity: 0.10 });
  ghostCore.setStyle({ fillOpacity: 0.75 });
});
map.on("mouseout", () => {
  ghost.setStyle({ fillOpacity: 0.0 });
  ghostCore.setStyle({ fillOpacity: 0.0 });
});
map.on("mousemove", (e) => {
  ghost.setLatLng(e.latlng);
  ghostCore.setLatLng(e.latlng);
});

function addLight(latlng, isMine = false) {
  L.circleMarker(latlng, {
    renderer: canvasRenderer,
    radius: isMine ? 2.4 : 1.5,      // üëà sehr klein f√ºr andere
    stroke: false,
    fill: true,
    fillOpacity: isMine ? 0.95 : 0.45, // üëà andere bewusst leiser
    fillColor: "rgba(255,255,255,1)",
    interactive: isMine
  }).addTo(lightsLayer);
}

async function loadMyLight(){
  const { data } = await sb.from('lights').select('*').eq('session', session).maybeSingle();
  return data;
}

async function loadLights(){
  try{
    const { data, error } = await sb.from('lights').select('*');
    if(error) throw error;

    allLightPoints = data || [];
    lightsLayer.clearLayers();

    let mine = null;
    for(const row of allLightPoints){
      const isMine = (row.session === session);
      if(isMine) mine = row;
      addLight([row.lat, row.lng], isMine);
    }

    const hintEl = document.getElementById("hint");
    if (mine) {
      hintEl.classList.add("hidden");
      setStatus("status_set");
    } else {
      hintEl.classList.remove("hidden");
      setStatus("status_empty");
    }

  } catch(e){
    console.error(e);
    setStatus("status_error_load");
  }
}

map.on('click', async (e) => {
  try{
    const pos = anonymize(e.latlng.lat, e.latlng.lng);
    const existing = await loadMyLight();

    if(existing){
      await sb.from('lights').update({ lat: pos.lat, lng: pos.lng }).eq('session', session);
    } else {
      await sb.from('lights').insert({ lat: pos.lat, lng: pos.lng, session });
    }
    await loadLights();
  } catch(err){
    console.error(err);
    setStatus("status_error_save");
  }
});

document.getElementById("btnWorld").addEventListener("click", () => {
  map.setView(WORLD_VIEW.center, WORLD_VIEW.zoom, { animate: true });
});

/* -------------------------
   7) Export (clean, stable)
-------------------------- */

const btnCard = document.getElementById("btnCard");

btnCard.addEventListener("click", async () => {
  try {
    setStatus("status_export");

    // 1) stabile Weltansicht (KEIN fitBounds)
    map.setView(WORLD_VIEW.center, WORLD_VIEW.zoom, { animate: false });

    // 2) Labels aus
    if (map.hasLayer(baseWithLabels)) map.removeLayer(baseWithLabels);
    baseNoLabels.addTo(map);

    // 3) Ghost & Overlays aus
    ghost.setStyle({ fillOpacity: 0 });
    ghostCore.setStyle({ fillOpacity: 0 });

    document.querySelector(".mapTint")?.style.setProperty("display", "none");
    document.querySelector(".mapShade")?.style.setProperty("display", "none");

    // 4) warten bis Tiles da sind
    await new Promise(r => setTimeout(r, 1200));

    // 5) Screenshot
    leafletImage(map, (err, canvas) => {

      // --- Restore IMMER ---
      document.querySelector(".mapTint")?.style.removeProperty("display");
      document.querySelector(".mapShade")?.style.removeProperty("display");

      map.removeLayer(baseNoLabels);
      baseWithLabels.addTo(map);

      if (err) {
        console.error(err);
        setStatus("status_error_save");
        return;
      }

      const png = canvas.toDataURL("image/png");
      const a = document.createElement("a");
      a.href = png;
      a.download = "together-we-are-one.png";
      a.click();

      setStatus("status_done");
    });

  } catch (e) {
    console.error(e);
    setStatus("status_error_save");
  }
});

/* -------------------------
   8) Start
-------------------------- */
loadLights();
setInterval(loadLights, 30000);
</script>
</body>
</html>
